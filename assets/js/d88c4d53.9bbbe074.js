"use strict";(self.webpackChunkdev_enigma=self.webpackChunkdev_enigma||[]).push([[53772],{28012:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>c});var s=i(74848),r=i(28453);const t={},l="URL Shortener System Design",a={id:"System-Design/Backend System Design/URL Shortener System Design",title:"URL Shortener System Design",description:"Table of Contents",source:"@site/docs/03-System-Design/Backend System Design/URL Shortener System Design.mdx",sourceDirName:"03-System-Design/Backend System Design",slug:"/System-Design/Backend System Design/URL Shortener System Design",permalink:"/docs/System-Design/Backend System Design/URL Shortener System Design",draft:!1,unlisted:!1,editUrl:"https://github.com/carefree-ladka/docs/03-System-Design/Backend System Design/URL Shortener System Design.mdx",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"System Design Trade-offs",permalink:"/docs/System-Design/Backend System Design/System Design Trade-offs"},next:{title:"Low Level Design",permalink:"/docs/category/low-level-design"}},o={},c=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Requirements (~5 minutes)",id:"requirements-5-minutes",level:2},{value:"1) Functional Requirements",id:"1-functional-requirements",level:3},{value:"2) Non-functional Requirements",id:"2-non-functional-requirements",level:3},{value:"3) Capacity Estimation",id:"3-capacity-estimation",level:3},{value:"Core Entities (~2 minutes)",id:"core-entities-2-minutes",level:2},{value:"API or System Interface (~5 minutes)",id:"api-or-system-interface-5-minutes",level:2},{value:"Protocol Choice: REST + HTTP Redirects",id:"protocol-choice-rest--http-redirects",level:3},{value:"Core API Endpoints",id:"core-api-endpoints",level:3},{value:"Data Flow (~5 minutes)",id:"data-flow-5-minutes",level:2},{value:"URL Shortening Flow",id:"url-shortening-flow",level:3},{value:"URL Redirection Flow",id:"url-redirection-flow",level:3},{value:"High Level Design (~10-15 minutes)",id:"high-level-design-10-15-minutes",level:2},{value:"Design Approach",id:"design-approach",level:3},{value:"System Architecture",id:"system-architecture",level:3},{value:"Detailed Component Design",id:"detailed-component-design",level:3},{value:"Database Schema",id:"database-schema",level:3},{value:"Technology Stack",id:"technology-stack",level:3},{value:"Deep Dives (~10 minutes)",id:"deep-dives-10-minutes",level:2},{value:"1. Short Code Generation Strategy",id:"1-short-code-generation-strategy",level:3},{value:"2. Caching Strategy",id:"2-caching-strategy",level:3},{value:"3. Database Scaling Strategy",id:"3-database-scaling-strategy",level:3},{value:"4. Analytics Processing",id:"4-analytics-processing",level:3},{value:"5. Security and Abuse Prevention",id:"5-security-and-abuse-prevention",level:3},{value:"6. Monitoring and Observability",id:"6-monitoring-and-observability",level:3},{value:"Summary",id:"summary",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"url-shortener-system-design",children:"URL Shortener System Design"})}),"\n",(0,s.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#requirements-5-minutes",children:"Requirements (~5 minutes)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#1-functional-requirements",children:"Functional Requirements"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#2-non-functional-requirements",children:"Non-functional Requirements"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#3-capacity-estimation",children:"Capacity Estimation"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#core-entities-2-minutes",children:"Core Entities (~2 minutes)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#api-or-system-interface-5-minutes",children:"API or System Interface (~5 minutes)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#data-flow-5-minutes",children:"Data Flow (~5 minutes)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#high-level-design-10-15-minutes",children:"High Level Design (~10-15 minutes)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#deep-dives-10-minutes",children:"Deep Dives (~10 minutes)"})}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"requirements-5-minutes",children:"Requirements (~5 minutes)"}),"\n",(0,s.jsx)(n.h3,{id:"1-functional-requirements",children:"1) Functional Requirements"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Questions Asked:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Q: What's the expected scale - how many URLs will be shortened daily?"}),"\n",(0,s.jsx)(n.li,{children:"A: Target 100M URLs shortened per day with 100:1 read-to-write ratio"}),"\n",(0,s.jsx)(n.li,{children:"Q: Do we need custom aliases or just random short URLs?"}),"\n",(0,s.jsx)(n.li,{children:"A: Support both - random generation and custom aliases"}),"\n",(0,s.jsx)(n.li,{children:"Q: Should we track analytics like click counts and user agents?"}),"\n",(0,s.jsx)(n.li,{children:"A: Yes, basic analytics are required for business insights"}),"\n",(0,s.jsx)(n.li,{children:"Q: What's the URL expiration policy?"}),"\n",(0,s.jsx)(n.li,{children:"A: Default 1 year expiration, but configurable per URL"}),"\n",(0,s.jsx)(n.li,{children:"Q: Do we need user accounts or anonymous URL creation?"}),"\n",(0,s.jsx)(n.li,{children:"A: Support both - anonymous and registered user creation"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Core Functional Requirements:"})}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Users should be able to shorten long URLs into compact URLs"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Users should be able to redirect from short URLs to original URLs"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Users should be able to set custom aliases for short URLs"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Users should be able to view click analytics for their URLs"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Users should be able to set expiration dates for URLs"]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["\ud83d\udca1 ",(0,s.jsx)(n.strong,{children:"Tip:"})," Focus on URL shortening and redirection as core features, with analytics as supporting functionality."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-non-functional-requirements",children:"2) Non-functional Requirements"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"System Quality Requirements:"})}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"High Availability:"})," 99.99% uptime for URL redirections (higher than creation)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"Low Latency:"})," URL redirection should be < 100ms globally"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"Scale:"})," Handle 100M URL creations/day, 10B redirections/day"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"Durability:"})," URLs should never be lost once created"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"Security:"})," Prevent malicious URLs, spam, and abuse"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Rationale:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Redirection Priority:"})," Once a URL is shared, it must always work"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Global Performance:"})," Users expect instant redirects worldwide"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Massive Read Scale:"})," 100:1 read-to-write ratio requires heavy caching"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-capacity-estimation",children:"3) Capacity Estimation"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Calculations That Influence Design:"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"URL Creation:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"100M new URLs/day = 1,157 URLs/second average"}),"\n",(0,s.jsx)(n.li,{children:"Peak traffic: 3x average = 3,500 URLs/second"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.em,{children:"Impact:"})," Database write optimization and connection pooling needed"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"URL Redirections:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"10B redirections/day = 115,740 redirections/second average"}),"\n",(0,s.jsx)(n.li,{children:"Peak traffic: 230,000 redirections/second"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.em,{children:"Impact:"})," Heavy caching strategy and CDN distribution required"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Storage Requirements:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"100M URLs/day \xd7 500 bytes average = 50GB/day = 18TB/year"}),"\n",(0,s.jsx)(n.li,{children:"5-year retention = 90TB total storage needed"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.em,{children:"Impact:"})," Horizontal database sharding required"]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"These calculations directly influence our caching, CDN, and database partitioning strategies."}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"core-entities-2-minutes",children:"Core Entities (~2 minutes)"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Primary Entities:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"URL:"})," Short code, original URL, creator info, expiration, status"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"User:"})," Account information, API keys, usage quotas"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Analytics:"})," Click events, user agents, referrers, timestamps"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"CustomAlias:"})," User-defined short codes and their mappings"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Entity Relationships:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["User has many URLs (1",":N",")"]}),"\n",(0,s.jsxs)(n.li,{children:["URL has many Analytics events (1",":N",")"]}),"\n",(0,s.jsx)(n.li,{children:"CustomAlias belongs to one URL (1:1)"}),"\n",(0,s.jsxs)(n.li,{children:["User can create many CustomAliases (1",":N",")"]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"These entities support both anonymous and authenticated URL creation with comprehensive tracking."}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"api-or-system-interface-5-minutes",children:"API or System Interface (~5 minutes)"}),"\n",(0,s.jsx)(n.h3,{id:"protocol-choice-rest--http-redirects",children:"Protocol Choice: REST + HTTP Redirects"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Reasoning:"})," REST for management operations, HTTP 301/302 redirects for URL redirection. Simple and cacheable."]}),"\n",(0,s.jsx)(n.h3,{id:"core-api-endpoints",children:"Core API Endpoints"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"URL Shortening:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// Create short URL\nPOST /v1/urls\n{\n  "originalUrl": "https://example.com/very/long/path",\n  "customAlias": "my-link", // Optional\n  "expiresAt": "2024-12-31T23:59:59Z", // Optional\n  "userId": "user123" // Optional for registered users\n}\n-> {\n  "shortCode": "aB3xY9",\n  "shortUrl": "https://short.ly/aB3xY9",\n  "originalUrl": "https://example.com/very/long/path",\n  "expiresAt": "2024-12-31T23:59:59Z"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"URL Redirection:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// Redirect to original URL\nGET /aB3xY9\n-> HTTP 301 Redirect\nLocation: https://example.com/very/long/path\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"URL Management:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// Get URL details\nGET /v1/urls/:shortCode -> URL\n\n// Update URL (owner only)\nPUT /v1/urls/:shortCode\n{\n  "originalUrl": "https://updated-example.com",\n  "expiresAt": "2025-12-31T23:59:59Z"\n}\n\n// Deactivate URL\nDELETE /v1/urls/:shortCode\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Analytics:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// Get URL analytics\nGET /v1/urls/:shortCode/analytics?period=7d -> {\n  "totalClicks": 1500,\n  "uniqueClicks": 800,\n  "clicksByDay": [...],\n  "topCountries": [...],\n  "topReferrers": [...]\n}\n\n// Get user\'s URLs\nGET /v1/users/:userId/urls?page=1&limit=20 -> URL[]\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Security Notes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Rate limiting: 100 URL creations/hour per IP, 1000/hour for authenticated users"}),"\n",(0,s.jsx)(n.li,{children:"Malicious URL detection using domain blacklists and content scanning"}),"\n",(0,s.jsx)(n.li,{children:"Custom alias validation to prevent reserved words and profanity"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"data-flow-5-minutes",children:"Data Flow (~5 minutes)"}),"\n",(0,s.jsx)(n.h3,{id:"url-shortening-flow",children:"URL Shortening Flow"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Request Validation:"})," Validate original URL format and accessibility"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Duplicate Check:"})," Check if URL already shortened (optional deduplication)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Short Code Generation:"})," Generate unique base62 code or validate custom alias"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Database Storage:"})," Store URL mapping in primary database"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cache Preload:"})," Proactively cache new URL in Redis for fast access"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Response:"})," Return short URL to client"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Analytics Setup:"})," Initialize analytics tracking for the new URL"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"url-redirection-flow",children:"URL Redirection Flow"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Extract Short Code:"})," Parse short code from incoming request"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cache Lookup:"})," Check Redis cache for URL mapping"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cache Hit:"})," Return cached original URL with 301 redirect"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cache Miss:"})," Query database for URL mapping"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Validation:"})," Check if URL is active and not expired"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Update Cache:"})," Store URL mapping in cache with TTL"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Analytics Logging:"})," Asynchronously log click event"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Redirect:"})," Send HTTP 301/302 redirect to original URL"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"high-level-design-10-15-minutes",children:"High Level Design (~10-15 minutes)"}),"\n",(0,s.jsx)(n.h3,{id:"design-approach",children:"Design Approach"}),"\n",(0,s.jsx)(n.p,{children:"Building the system to handle massive read scale with global distribution:"}),"\n",(0,s.jsx)(n.h3,{id:"system-architecture",children:"System Architecture"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"[Global Users] -> [CDN (CloudFront)] -> [Geographic Load Balancer]\n                                              |\n                          +-------------------+-------------------+\n                          |                   |                   |\n                    [US-East Region]    [EU Region]        [Asia Region]\n                          |                   |                   |\n                    [Regional LB]       [Regional LB]       [Regional LB]\n                          |                   |                   |\n                    [API Gateway]       [API Gateway]       [API Gateway]\n                          |                   |                   |\n              +-----------+-----------+       |                   |\n              |           |           |       |                   |\n        [URL Service] [Analytics] [Cache]     |                   |\n              |           |           |       |                   |\n        [URL Database] [Metrics DB] [Redis]   |                   |\n         (PostgreSQL)   (ClickHouse)  (Cluster) |                 |\n                          |                   |                   |\n                          +------- Replication --------+\n"})}),"\n",(0,s.jsx)(n.h3,{id:"detailed-component-design",children:"Detailed Component Design"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. POST /v1/urls (URL Shortening)"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Client"})," \u2192 ",(0,s.jsx)(n.strong,{children:"CDN"})," \u2192 ",(0,s.jsx)(n.strong,{children:"Regional Load Balancer"})," \u2192 ",(0,s.jsx)(n.strong,{children:"API Gateway"})," \u2192 ",(0,s.jsx)(n.strong,{children:"URL Service"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"URL Service"})," validates URL and generates/validates short code"]}),"\n",(0,s.jsxs)(n.li,{children:["Store mapping in ",(0,s.jsx)(n.strong,{children:"URL Database"})," with replication"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cache Service"})," preloads URL in ",(0,s.jsx)(n.strong,{children:"Redis"})," for fast access"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Analytics Service"})," initializes tracking for new URL"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["2. GET /",":shortCode"," (URL Redirection)"]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Client"})," \u2192 ",(0,s.jsx)(n.strong,{children:"CDN"})," (cache miss) \u2192 ",(0,s.jsx)(n.strong,{children:"Regional Load Balancer"})," \u2192 ",(0,s.jsx)(n.strong,{children:"URL Service"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"URL Service"})," checks ",(0,s.jsx)(n.strong,{children:"Redis Cache"})," first for URL mapping"]}),"\n",(0,s.jsxs)(n.li,{children:["On cache miss: Query ",(0,s.jsx)(n.strong,{children:"URL Database"})," and update cache"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Analytics Service"})," asynchronously logs click event"]}),"\n",(0,s.jsxs)(n.li,{children:["Return ",(0,s.jsx)(n.strong,{children:"HTTP 301 Redirect"})," to original URL"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["3. GET /v1/urls/",":shortCode","/analytics"]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Client"})," \u2192 ",(0,s.jsx)(n.strong,{children:"API Gateway"})," \u2192 ",(0,s.jsx)(n.strong,{children:"Analytics Service"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Analytics Service"})," queries ",(0,s.jsx)(n.strong,{children:"ClickHouse"})," for aggregated metrics"]}),"\n",(0,s.jsx)(n.li,{children:"Apply time-based filtering and return formatted analytics"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"database-schema",children:"Database Schema"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"URLs Table:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Entity\n@Table(name = "urls")\npublic class URL {\n    @Id\n    @Column(name = "short_code", length = 10)\n    private String shortCode;\n\n    @Column(name = "original_url", length = 2048, nullable = false)\n    private String originalUrl;\n\n    @Column(name = "user_id", length = 36)\n    private String userId; // Optional for anonymous URLs\n\n    @Column(name = "custom_alias", length = 50)\n    private String customAlias;\n\n    @Column(name = "created_at", nullable = false)\n    private LocalDateTime createdAt;\n\n    @Column(name = "expires_at")\n    private LocalDateTime expiresAt;\n\n    @Column(name = "is_active", nullable = false)\n    private Boolean isActive = true;\n\n    @Column(name = "click_count")\n    private Long clickCount = 0L; // Denormalized for performance\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Users Table:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Entity\n@Table(name = "users")\npublic class User {\n    @Id\n    @Column(name = "user_id", length = 36)\n    private String userId;\n\n    @Column(name = "email", length = 255, unique = true)\n    private String email;\n\n    @Column(name = "api_key", length = 64, unique = true)\n    private String apiKey;\n\n    @Column(name = "daily_quota")\n    private Integer dailyQuota = 1000;\n\n    @Column(name = "created_at", nullable = false)\n    private LocalDateTime createdAt;\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Click Events Table (ClickHouse):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// Optimized for analytics - stored in ClickHouse for fast aggregation\npublic class ClickEvent {\n    private String eventId;\n    private String shortCode;\n    private String ipHash; // Hashed for privacy\n    private String userAgent;\n    private String referrer;\n    private String country;\n    private String city;\n    private LocalDateTime timestamp;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Custom Aliases Table:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Entity\n@Table(name = "custom_aliases")\npublic class CustomAlias {\n    @Id\n    @Column(name = "alias", length = 50)\n    private String alias;\n\n    @Column(name = "short_code", length = 10, nullable = false)\n    private String shortCode;\n\n    @Column(name = "user_id", length = 36, nullable = false)\n    private String userId;\n\n    @Column(name = "created_at", nullable = false)\n    private LocalDateTime createdAt;\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"technology-stack",children:"Technology Stack"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Application:"})," Java Spring Boot microservices"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Database:"})," PostgreSQL for URL storage, ClickHouse for analytics"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cache:"})," Redis Cluster for distributed caching"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Message Queue:"})," Apache Kafka for analytics events"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Storage:"})," AWS S3 for logs and backups"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"CDN:"})," CloudFront for global distribution"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Load Balancer:"})," AWS Application Load Balancer"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"deep-dives-10-minutes",children:"Deep Dives (~10 minutes)"}),"\n",(0,s.jsx)(n.h3,{id:"1-short-code-generation-strategy",children:"1. Short Code Generation Strategy"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Challenge:"})," Generate unique, short codes at scale while avoiding collisions."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Solution: Base62 Encoding with Counter + Random"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Service\npublic class ShortCodeGenerator {\n    private static final String BASE62_CHARS =\n        "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";\n    private static final int BASE = 62;\n\n    @Autowired\n    private RedisTemplate<String, String> redisTemplate;\n\n    public String generateShortCode() {\n        // Strategy 1: Counter-based (predictable but guaranteed unique)\n        Long counter = redisTemplate.opsForValue().increment("url_counter");\n        String counterCode = encodeBase62(counter);\n\n        // Strategy 2: Random + collision detection (unpredictable)\n        String randomCode;\n        do {\n            randomCode = generateRandomCode(7); // 62^7 = 3.5 trillion combinations\n        } while (urlExists(randomCode));\n\n        // Use shorter counter-based for first billion URLs, then random\n        return counter < 1_000_000_000L ? counterCode : randomCode;\n    }\n\n    private String encodeBase62(long value) {\n        if (value == 0) return "0";\n\n        StringBuilder result = new StringBuilder();\n        while (value > 0) {\n            result.append(BASE62_CHARS.charAt((int)(value % BASE)));\n            value /= BASE;\n        }\n        return result.reverse().toString();\n    }\n\n    private String generateRandomCode(int length) {\n        Random random = new SecureRandom();\n        StringBuilder code = new StringBuilder(length);\n        for (int i = 0; i < length; i++) {\n            code.append(BASE62_CHARS.charAt(random.nextInt(BASE)));\n        }\n        return code.toString();\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-caching-strategy",children:"2. Caching Strategy"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Challenge:"})," Achieve < 100ms redirect latency globally with 230K RPS peak load."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Multi-tier Caching Strategy:"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Tier 1: CDN Edge Caching"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@RestController\npublic class RedirectController {\n\n    @GetMapping("/{shortCode}")\n    public ResponseEntity<Void> redirect(@PathVariable String shortCode) {\n        String originalUrl = urlService.getOriginalUrl(shortCode);\n\n        if (originalUrl == null) {\n            return ResponseEntity.notFound().build();\n        }\n\n        // Set aggressive caching headers for CDN\n        HttpHeaders headers = new HttpHeaders();\n        headers.setLocation(URI.create(originalUrl));\n        headers.setCacheControl(CacheControl.maxAge(Duration.ofHours(24))\n            .mustRevalidate().cachePublic());\n\n        // Log analytics asynchronously\n        analyticsService.logClickAsync(shortCode, request);\n\n        return ResponseEntity.status(HttpStatus.MOVED_PERMANENTLY)\n            .headers(headers).build();\n    }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Tier 2: Application-level Redis Caching"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Service\npublic class URLService {\n\n    @Autowired\n    private RedisTemplate<String, String> redisTemplate;\n\n    @Cacheable(value = "urls", key = "#shortCode")\n    public String getOriginalUrl(String shortCode) {\n        // Try Redis first\n        String cachedUrl = redisTemplate.opsForValue().get("url:" + shortCode);\n        if (cachedUrl != null) {\n            return cachedUrl;\n        }\n\n        // Fallback to database\n        URL url = urlRepository.findByShortCode(shortCode);\n        if (url != null && url.getIsActive() && !isExpired(url)) {\n            // Cache with TTL\n            redisTemplate.opsForValue().set("url:" + shortCode,\n                url.getOriginalUrl(), Duration.ofHours(1));\n            return url.getOriginalUrl();\n        }\n\n        return null;\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"3-database-scaling-strategy",children:"3. Database Scaling Strategy"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Challenge:"})," Handle 90TB of data with high write throughput and read performance."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Horizontal Sharding by Short Code:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class DatabaseShardingConfig {\n\n    public String determineShardKey(String shortCode) {\n        // Use first 2 characters for sharding\n        // 62^2 = 3,844 possible shards, use 64 actual shards\n        String shardPrefix = shortCode.substring(0, 2);\n        int shardHash = shardPrefix.hashCode();\n        return "shard_" + (Math.abs(shardHash) % 64);\n    }\n}\n\n@Service\npublic class ShardedURLRepository {\n\n    private final Map<String, JdbcTemplate> shardTemplates;\n\n    public URL findByShortCode(String shortCode) {\n        String shardKey = determineShardKey(shortCode);\n        JdbcTemplate template = shardTemplates.get(shardKey);\n\n        return template.queryForObject(\n            "SELECT * FROM urls WHERE short_code = ?",\n            new Object[]{shortCode},\n            new URLRowMapper()\n        );\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4-analytics-processing",children:"4. Analytics Processing"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Challenge:"})," Process billions of click events for real-time analytics."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Stream Processing with Kafka + ClickHouse:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@KafkaListener(topics = "click-events")\n@Service\npublic class AnalyticsProcessor {\n\n    @Autowired\n    private ClickHouseJdbcTemplate clickHouseTemplate;\n\n    public void processClickEvent(ClickEventMessage event) {\n        // Enrich event with geo-location data\n        GeoLocation location = geoService.getLocation(event.getIpAddress());\n\n        // Create analytics record\n        ClickEvent clickEvent = ClickEvent.builder()\n            .shortCode(event.getShortCode())\n            .timestamp(event.getTimestamp())\n            .country(location.getCountry())\n            .city(location.getCity())\n            .userAgent(event.getUserAgent())\n            .referrer(event.getReferrer())\n            .build();\n\n        // Batch insert into ClickHouse for performance\n        clickHouseTemplate.batchUpdate(clickEvent);\n\n        // Update real-time counters in Redis\n        redisTemplate.opsForHash().increment(\n            "url_stats:" + event.getShortCode(),\n            "click_count", 1\n        );\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"5-security-and-abuse-prevention",children:"5. Security and Abuse Prevention"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Challenge:"})," Prevent malicious URLs and system abuse."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Multi-layer Security Strategy:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Service\npublic class SecurityService {\n\n    private final Set<String> blockedDomains = Set.of(\n        "malicious-site.com", "spam-domain.net"\n    );\n\n    public boolean validateUrl(String url) {\n        try {\n            URI uri = URI.create(url);\n            String domain = uri.getHost().toLowerCase();\n\n            // Check against blocked domains\n            if (blockedDomains.contains(domain)) {\n                return false;\n            }\n\n            // Check URL reachability\n            HttpURLConnection connection =\n                (HttpURLConnection) uri.toURL().openConnection();\n            connection.setRequestMethod("HEAD");\n            connection.setConnectTimeout(5000);\n\n            int responseCode = connection.getResponseCode();\n            return responseCode >= 200 && responseCode < 400;\n\n        } catch (Exception e) {\n            return false;\n        }\n    }\n}\n\n@Component\npublic class RateLimitingFilter implements Filter {\n\n    @Override\n    public void doFilter(ServletRequest request, ServletResponse response,\n                        FilterChain chain) throws IOException, ServletException {\n\n        HttpServletRequest httpRequest = (HttpServletRequest) request;\n        String clientIp = getClientIp(httpRequest);\n        String userId = getUserId(httpRequest);\n\n        // Rate limiting logic\n        String key = userId != null ? "user:" + userId : "ip:" + clientIp;\n        Long requests = redisTemplate.opsForValue().increment(key);\n\n        if (requests == 1) {\n            redisTemplate.expire(key, Duration.ofHours(1));\n        }\n\n        int limit = userId != null ? 1000 : 100; // Higher limit for registered users\n\n        if (requests > limit) {\n            ((HttpServletResponse) response).setStatus(429); // Too Many Requests\n            return;\n        }\n\n        chain.doFilter(request, response);\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"6-monitoring-and-observability",children:"6. Monitoring and Observability"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Metrics Tracking:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Component\npublic class MetricsCollector {\n\n    private final MeterRegistry meterRegistry;\n    private final Counter urlCreationCounter;\n    private final Counter redirectionCounter;\n    private final Timer redirectionTimer;\n\n    public MetricsCollector(MeterRegistry meterRegistry) {\n        this.meterRegistry = meterRegistry;\n        this.urlCreationCounter = Counter.builder("urls.created")\n            .description("Number of URLs created")\n            .register(meterRegistry);\n        this.redirectionCounter = Counter.builder("urls.redirected")\n            .description("Number of URL redirections")\n            .register(meterRegistry);\n        this.redirectionTimer = Timer.builder("redirection.duration")\n            .description("Time taken for URL redirection")\n            .register(meterRegistry);\n    }\n\n    public void recordUrlCreation() {\n        urlCreationCounter.increment();\n    }\n\n    public void recordRedirection(Duration duration) {\n        redirectionCounter.increment();\n        redirectionTimer.record(duration);\n    }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Alerting Configuration:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Redirection latency > 200ms for 5 minutes \u2192 Critical alert"}),"\n",(0,s.jsx)(n.li,{children:"Error rate > 1% \u2192 Warning alert"}),"\n",(0,s.jsx)(n.li,{children:"Cache hit rate < 90% \u2192 Performance alert"}),"\n",(0,s.jsx)(n.li,{children:"Database connection pool exhaustion \u2192 Critical alert"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"This URL Shortener design successfully handles the core requirements:"}),"\n",(0,s.jsxs)(n.p,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Functional Requirements Met:"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Scalable URL shortening with custom aliases"}),"\n",(0,s.jsx)(n.li,{children:"Fast global URL redirection (< 100ms)"}),"\n",(0,s.jsx)(n.li,{children:"Comprehensive click analytics and reporting"}),"\n",(0,s.jsx)(n.li,{children:"Flexible expiration and URL management"}),"\n",(0,s.jsx)(n.li,{children:"Support for both anonymous and authenticated users"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Non-functional Requirements Addressed:"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Scale:"})," Handles 100M URL creations/day and 10B redirections/day"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Performance:"})," Multi-tier caching achieves < 100ms redirect latency"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Availability:"})," Global distribution provides 99.99% uptime"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security:"})," Multi-layer protection against abuse and malicious content"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Production-Ready Deep Dives:"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Efficient short code generation with collision avoidance"}),"\n",(0,s.jsx)(n.li,{children:"Multi-tier caching strategy for global performance"}),"\n",(0,s.jsx)(n.li,{children:"Horizontal database sharding for massive scale"}),"\n",(0,s.jsx)(n.li,{children:"Real-time analytics processing with stream computing"}),"\n",(0,s.jsx)(n.li,{children:"Comprehensive security and rate limiting"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The design scales from thousands to billions of URLs by leveraging distributed caching, database sharding, and global CDN distribution while maintaining the simplicity and reliability that users expect from a URL shortener."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>a});var s=i(96540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);