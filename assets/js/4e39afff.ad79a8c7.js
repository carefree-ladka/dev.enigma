"use strict";(self.webpackChunkdev_enigma=self.webpackChunkdev_enigma||[]).push([[3115],{28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>t});var s=i(96540);const r={},l=s.createContext(r);function c(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(l.Provider,{value:n},e.children)}},36101:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>a});var s=i(74848),r=i(28453);const l={},c="Google Drive System Design",t={id:"System Design Problems/Google Drive System Design",title:"Google Drive System Design",description:"Table of Contents",source:"@site/docs/System Design Problems/Google Drive System Design.mdx",sourceDirName:"System Design Problems",slug:"/System Design Problems/Google Drive System Design",permalink:"/dev.enigma/docs/System Design Problems/Google Drive System Design",draft:!1,unlisted:!1,editUrl:"https://github.com/carefree-ladka/docs/System Design Problems/Google Drive System Design.mdx",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Google Docs System Design",permalink:"/dev.enigma/docs/System Design Problems/Google Docs System Design"},next:{title:"Google Search System Design",permalink:"/dev.enigma/docs/System Design Problems/Google Search System Design"}},d={},a=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Functional Requirements",id:"functional-requirements",level:3},{value:"Non-Functional Requirements",id:"non-functional-requirements",level:3},{value:"Core Entities",id:"core-entities",level:2},{value:"1. User",id:"1-user",level:3},{value:"2. File",id:"2-file",level:3},{value:"3. Folder",id:"3-folder",level:3},{value:"4. FileVersion",id:"4-fileversion",level:3},{value:"5. Permission",id:"5-permission",level:3},{value:"6. SyncMetadata",id:"6-syncmetadata",level:3},{value:"API Interface",id:"api-interface",level:2},{value:"Authentication APIs",id:"authentication-apis",level:3},{value:"File Management APIs",id:"file-management-apis",level:3},{value:"Folder Management APIs",id:"folder-management-apis",level:3},{value:"Sharing &amp; Permissions APIs",id:"sharing--permissions-apis",level:3},{value:"Synchronization APIs",id:"synchronization-apis",level:3},{value:"Search APIs",id:"search-apis",level:3},{value:"Storage Management APIs",id:"storage-management-apis",level:3},{value:"Data Flow",id:"data-flow",level:2},{value:"1. File Upload Flow",id:"1-file-upload-flow",level:3},{value:"2. File Download Flow",id:"2-file-download-flow",level:3},{value:"3. File Sync Flow",id:"3-file-sync-flow",level:3},{value:"4. Sharing Flow",id:"4-sharing-flow",level:3},{value:"5. Conflict Resolution Flow",id:"5-conflict-resolution-flow",level:3},{value:"High-Level Design",id:"high-level-design",level:2},{value:"System Architecture",id:"system-architecture",level:3},{value:"Component Responsibilities",id:"component-responsibilities",level:3},{value:"Deep Dives",id:"deep-dives",level:2},{value:"Deep Dive 1: File Upload System",id:"deep-dive-1-file-upload-system",level:3},{value:"Upload Architecture",id:"upload-architecture",level:4},{value:"Deep Dive 2: Synchronization Service",id:"deep-dive-2-synchronization-service",level:3},{value:"Sync Architecture",id:"sync-architecture",level:4},{value:"Deep Dive 3: Metadata Management",id:"deep-dive-3-metadata-management",level:3},{value:"Metadata Architecture",id:"metadata-architecture",level:4},{value:"Deep Dive 4: Sharing &amp; Permissions",id:"deep-dive-4-sharing--permissions",level:3},{value:"Permission Model",id:"permission-model",level:4},{value:"Deep Dive 5: Search &amp; Indexing",id:"deep-dive-5-search--indexing",level:3},{value:"Search Architecture",id:"search-architecture",level:4},{value:"Deep Dive 6: Real-time Collaboration",id:"deep-dive-6-real-time-collaboration",level:3},{value:"Collaborative Editing Architecture",id:"collaborative-editing-architecture",level:4},{value:"Database Schema",id:"database-schema",level:2},{value:"PostgreSQL Schema",id:"postgresql-schema",level:3},{value:"Cassandra Schema (for Sync Events)",id:"cassandra-schema-for-sync-events",level:3},{value:"Redis Cache Schema",id:"redis-cache-schema",level:3},{value:"Capacity Estimation",id:"capacity-estimation",level:2},{value:"Traffic Estimates",id:"traffic-estimates",level:3},{value:"Storage Estimates",id:"storage-estimates",level:3},{value:"Bandwidth Estimates",id:"bandwidth-estimates",level:3},{value:"Memory Estimates",id:"memory-estimates",level:3},{value:"Server Estimates",id:"server-estimates",level:3},{value:"Scalability &amp; Optimization",id:"scalability--optimization",level:2},{value:"Horizontal Scaling Strategies",id:"horizontal-scaling-strategies",level:3},{value:"Performance Optimization",id:"performance-optimization",level:3},{value:"Availability &amp; Reliability",id:"availability--reliability",level:3},{value:"Security Measures",id:"security-measures",level:3},{value:"Cost Optimization",id:"cost-optimization",level:3},{value:"Estimated Costs (Monthly)",id:"estimated-costs-monthly",level:3},{value:"Summary",id:"summary",level:2},{value:"Key Design Decisions",id:"key-design-decisions",level:3},{value:"Trade-offs",id:"trade-offs",level:3},{value:"Scale Summary",id:"scale-summary",level:3},{value:"Future Enhancements",id:"future-enhancements",level:3},{value:"Appendix",id:"appendix",level:2},{value:"API Request/Response Examples",id:"api-requestresponse-examples",level:3},{value:"WebSocket Events",id:"websocket-events",level:3},{value:"Error Handling",id:"error-handling",level:3},{value:"Monitoring Metrics",id:"monitoring-metrics",level:3},{value:"Conclusion",id:"conclusion",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"google-drive-system-design",children:"Google Drive System Design"})}),"\n",(0,s.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#requirements",children:"Requirements"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#core-entities",children:"Core Entities"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#api-interface",children:"API Interface"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#data-flow",children:"Data Flow"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#high-level-design",children:"High-Level Design (HLD)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#deep-dives",children:"Deep Dives"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#database-schema",children:"Database Schema"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#capacity-estimation",children:"Capacity Estimation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#scalability-optimization",children:"Scalability & Optimization"})}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,s.jsx)(n.h3,{id:"functional-requirements",children:"Functional Requirements"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Core Features:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"File Operations"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Upload files (single and batch)"}),"\n",(0,s.jsx)(n.li,{children:"Download files"}),"\n",(0,s.jsx)(n.li,{children:"Delete files (trash and permanent)"}),"\n",(0,s.jsx)(n.li,{children:"Copy and move files"}),"\n",(0,s.jsx)(n.li,{children:"File versioning"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Folder Operations"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Create, rename, delete folders"}),"\n",(0,s.jsx)(n.li,{children:"Move files/folders between folders"}),"\n",(0,s.jsx)(n.li,{children:"Nested folder hierarchy"}),"\n",(0,s.jsx)(n.li,{children:"Folder permissions"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Sharing & Permissions"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Share files/folders with specific users"}),"\n",(0,s.jsx)(n.li,{children:"Share via public/private links"}),"\n",(0,s.jsx)(n.li,{children:"Permission levels: Viewer, Commenter, Editor, Owner"}),"\n",(0,s.jsx)(n.li,{children:"Revoke access"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Synchronization"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Sync files across devices"}),"\n",(0,s.jsx)(n.li,{children:"Desktop client synchronization"}),"\n",(0,s.jsx)(n.li,{children:"Mobile app synchronization"}),"\n",(0,s.jsx)(n.li,{children:"Conflict detection and resolution"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Search & Organization"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Search by filename"}),"\n",(0,s.jsx)(n.li,{children:"Search by file type"}),"\n",(0,s.jsx)(n.li,{children:"Filter by date, owner"}),"\n",(0,s.jsx)(n.li,{children:"Star/favorite files"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Storage Management"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Track storage quota per user"}),"\n",(0,s.jsx)(n.li,{children:"Display storage breakdown by file type"}),"\n",(0,s.jsx)(n.li,{children:"Warn when approaching limit"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"non-functional-requirements",children:"Non-Functional Requirements"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Availability"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"99.99% uptime"}),"\n",(0,s.jsx)(n.li,{children:"No single point of failure"}),"\n",(0,s.jsx)(n.li,{children:"Graceful degradation"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Consistency"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Strong consistency for file metadata"}),"\n",(0,s.jsx)(n.li,{children:"Eventual consistency for synchronization"}),"\n",(0,s.jsx)(n.li,{children:"Conflict-free file versioning"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Performance"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Fast upload/download (utilize full bandwidth)"}),"\n",(0,s.jsx)(n.li,{children:"Sync latency < 2 seconds"}),"\n",(0,s.jsx)(n.li,{children:"API response < 200ms"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Scalability"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Support billions of files"}),"\n",(0,s.jsx)(n.li,{children:"Handle millions of concurrent users"}),"\n",(0,s.jsx)(n.li,{children:"Efficient storage utilization"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Security"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"End-to-end encryption for files at rest"}),"\n",(0,s.jsx)(n.li,{children:"Encryption in transit (HTTPS)"}),"\n",(0,s.jsx)(n.li,{children:"Secure sharing with access controls"}),"\n",(0,s.jsx)(n.li,{children:"Audit logs for compliance"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Reliability"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Data durability: 99.999999999% (11 nines)"}),"\n",(0,s.jsx)(n.li,{children:"Automatic backups"}),"\n",(0,s.jsx)(n.li,{children:"Disaster recovery"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"core-entities",children:"Core Entities"}),"\n",(0,s.jsx)(n.h3,{id:"1-user",children:"1. User"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"User {\n  user_id: UUID (primary key)\n  email: string (unique)\n  name: string\n  storage_quota: long (bytes)\n  storage_used: long (bytes)\n  created_at: timestamp\n  last_login: timestamp\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Attributes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Unique identifier for each user"}),"\n",(0,s.jsx)(n.li,{children:"Email for authentication and notifications"}),"\n",(0,s.jsx)(n.li,{children:"Storage quota and usage tracking"}),"\n",(0,s.jsx)(n.li,{children:"Account metadata"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-file",children:"2. File"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"File {\n  file_id: UUID (primary key)\n  name: string\n  parent_folder_id: UUID (foreign key)\n  owner_id: UUID (foreign key to User)\n  size: long (bytes)\n  mime_type: string\n  storage_path: string\n  checksum: string (SHA-256)\n  version: integer\n  is_deleted: boolean\n  created_at: timestamp\n  updated_at: timestamp\n  deleted_at: timestamp\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Attributes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Unique file identifier"}),"\n",(0,s.jsx)(n.li,{children:"Parent folder for hierarchy"}),"\n",(0,s.jsx)(n.li,{children:"Owner and permissions"}),"\n",(0,s.jsx)(n.li,{children:"Storage location and metadata"}),"\n",(0,s.jsx)(n.li,{children:"Version tracking"}),"\n",(0,s.jsx)(n.li,{children:"Soft delete support"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-folder",children:"3. Folder"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Folder {\n  folder_id: UUID (primary key)\n  name: string\n  parent_folder_id: UUID (foreign key, nullable for root)\n  owner_id: UUID (foreign key to User)\n  is_deleted: boolean\n  created_at: timestamp\n  updated_at: timestamp\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Attributes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Unique folder identifier"}),"\n",(0,s.jsx)(n.li,{children:"Hierarchical structure via parent reference"}),"\n",(0,s.jsx)(n.li,{children:"Owner and permissions"}),"\n",(0,s.jsx)(n.li,{children:"Soft delete support"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"4-fileversion",children:"4. FileVersion"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"FileVersion {\n  version_id: UUID (primary key)\n  file_id: UUID (foreign key)\n  version_number: integer\n  size: long\n  storage_path: string\n  checksum: string\n  created_at: timestamp\n  created_by: UUID (foreign key to User)\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Attributes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Track all versions of a file"}),"\n",(0,s.jsx)(n.li,{children:"Storage location for each version"}),"\n",(0,s.jsx)(n.li,{children:"Version metadata and creator"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"5-permission",children:"5. Permission"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Permission {\n  permission_id: UUID (primary key)\n  resource_id: UUID (file_id or folder_id)\n  resource_type: enum (FILE, FOLDER)\n  user_id: UUID (foreign key to User, nullable)\n  permission_type: enum (OWNER, EDITOR, COMMENTER, VIEWER)\n  is_public: boolean\n  share_link: string (nullable)\n  created_at: timestamp\n  expires_at: timestamp (nullable)\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Attributes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Granular access control per file/folder"}),"\n",(0,s.jsx)(n.li,{children:"Support for user-specific and public sharing"}),"\n",(0,s.jsx)(n.li,{children:"Permission hierarchy (owner > editor > commenter > viewer)"}),"\n",(0,s.jsx)(n.li,{children:"Optional expiration"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"6-syncmetadata",children:"6. SyncMetadata"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"SyncMetadata {\n  sync_id: UUID (primary key)\n  user_id: UUID (foreign key)\n  device_id: string\n  file_id: UUID (foreign key)\n  local_path: string\n  last_synced: timestamp\n  sync_status: enum (SYNCED, PENDING, CONFLICT)\n  checksum: string\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Attributes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Track sync status per device"}),"\n",(0,s.jsx)(n.li,{children:"Detect conflicts"}),"\n",(0,s.jsx)(n.li,{children:"Map cloud files to local paths"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"api-interface",children:"API Interface"}),"\n",(0,s.jsx)(n.h3,{id:"authentication-apis",children:"Authentication APIs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"POST   /api/v1/auth/login\nPOST   /api/v1/auth/logout\nPOST   /api/v1/auth/refresh-token\nGET    /api/v1/auth/me\n"})}),"\n",(0,s.jsx)(n.h3,{id:"file-management-apis",children:"File Management APIs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"POST   /api/v1/files/upload\nGET    /api/v1/files/{file_id}\nGET    /api/v1/files/{file_id}/download\nPUT    /api/v1/files/{file_id}\nDELETE /api/v1/files/{file_id}\nPOST   /api/v1/files/{file_id}/copy\nPOST   /api/v1/files/{file_id}/move\nGET    /api/v1/files/{file_id}/versions\nPOST   /api/v1/files/{file_id}/restore\n"})}),"\n",(0,s.jsx)(n.h3,{id:"folder-management-apis",children:"Folder Management APIs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"POST   /api/v1/folders\nGET    /api/v1/folders/{folder_id}\nPUT    /api/v1/folders/{folder_id}\nDELETE /api/v1/folders/{folder_id}\nGET    /api/v1/folders/{folder_id}/contents\nPOST   /api/v1/folders/{folder_id}/move\n"})}),"\n",(0,s.jsx)(n.h3,{id:"sharing--permissions-apis",children:"Sharing & Permissions APIs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"POST   /api/v1/files/{file_id}/share\nGET    /api/v1/files/{file_id}/permissions\nPUT    /api/v1/permissions/{permission_id}\nDELETE /api/v1/permissions/{permission_id}\nPOST   /api/v1/files/{file_id}/share-link\nGET    /api/v1/shared-with-me\n"})}),"\n",(0,s.jsx)(n.h3,{id:"synchronization-apis",children:"Synchronization APIs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"GET    /api/v1/sync/changes?cursor={cursor}\nPOST   /api/v1/sync/register-device\nGET    /api/v1/sync/status\nPOST   /api/v1/sync/resolve-conflict\n"})}),"\n",(0,s.jsx)(n.h3,{id:"search-apis",children:"Search APIs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"GET    /api/v1/search?q={query}&type={file_type}&owner={owner}\nGET    /api/v1/recent\nGET    /api/v1/starred\n"})}),"\n",(0,s.jsx)(n.h3,{id:"storage-management-apis",children:"Storage Management APIs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"GET    /api/v1/storage/quota\nGET    /api/v1/storage/breakdown\nGET    /api/v1/trash\nPOST   /api/v1/trash/{file_id}/restore\nDELETE /api/v1/trash/{file_id}/permanent\nPOST   /api/v1/trash/empty\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"data-flow",children:"Data Flow"}),"\n",(0,s.jsx)(n.h3,{id:"1-file-upload-flow",children:"1. File Upload Flow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"User Upload Request\n    \u2193\nAPI Gateway (Auth & Validation)\n    \u2193\nApplication Server\n    \u2193\n\u251c\u2500\u2192 Metadata Service\n\u2502   \u251c\u2500\u2192 Generate file_id\n\u2502   \u251c\u2500\u2192 Check storage quota\n\u2502   \u251c\u2500\u2192 Create metadata entry in DB\n\u2502   \u2514\u2500\u2192 Return upload URL\n\u2502\n\u2514\u2500\u2192 Client receives upload URL\n    \u2193\nClient uploads to Storage Service\n    \u2193\n\u251c\u2500\u2192 Chunk file (if large)\n\u251c\u2500\u2192 Calculate checksum\n\u251c\u2500\u2192 Upload chunks to Object Storage\n\u2514\u2500\u2192 Verify integrity\n    \u2193\nStorage Service confirms upload\n    \u2193\nMetadata Service updates status\n    \u2193\n\u251c\u2500\u2192 Update file status to COMPLETE\n\u251c\u2500\u2192 Update user storage_used\n\u251c\u2500\u2192 Add to file version history\n\u2514\u2500\u2192 Trigger sync notification\n    \u2193\nNotification Service\n    \u2193\nNotify other devices via WebSocket/Push\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-file-download-flow",children:"2. File Download Flow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"User Download Request\n    \u2193\nAPI Gateway (Auth & Permission Check)\n    \u2193\nApplication Server\n    \u2193\nMetadata Service\n    \u2193\n\u251c\u2500\u2192 Verify file exists\n\u251c\u2500\u2192 Check user permissions\n\u2514\u2500\u2192 Get storage location\n    \u2193\nCheck CDN Cache\n    \u2193\n\u251c\u2500\u2192 Cache Hit: Return from CDN\n\u2514\u2500\u2192 Cache Miss: Fetch from Object Storage\n    \u2193\nObject Storage\n    \u2193\n\u251c\u2500\u2192 Stream file chunks\n\u251c\u2500\u2192 Update CDN cache\n\u2514\u2500\u2192 Return to client\n    \u2193\nClient receives file\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-file-sync-flow",children:"3. File Sync Flow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Device A: File Modified\n    \u2193\nDesktop Client detects change\n    \u2193\n\u251c\u2500\u2192 Calculate checksum\n\u251c\u2500\u2192 Compare with last sync\n\u2514\u2500\u2192 Detect modification\n    \u2193\nUpload to Cloud (via Upload Flow)\n    \u2193\nMetadata Service\n    \u2193\n\u251c\u2500\u2192 Update file version\n\u251c\u2500\u2192 Create change event\n\u2514\u2500\u2192 Add to sync queue\n    \u2193\nNotification Service\n    \u2193\n\u251c\u2500\u2192 WebSocket: Notify online devices\n\u2514\u2500\u2192 Push: Notify offline devices\n    \u2193\nDevice B receives notification\n    \u2193\nDesktop Client on Device B\n    \u2193\n\u251c\u2500\u2192 Fetch change events (polling/WebSocket)\n\u251c\u2500\u2192 Compare local checksum\n\u2514\u2500\u2192 Detect conflict or update needed\n    \u2193\nDownload modified file\n    \u2193\nApply changes locally\n    \u2193\nUpdate sync metadata\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-sharing-flow",children:"4. Sharing Flow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'User initiates share\n    \u2193\nAPI Gateway\n    \u2193\nPermission Service\n    \u2193\n\u251c\u2500\u2192 Validate share request\n\u251c\u2500\u2192 Check owner permissions\n\u2514\u2500\u2192 Create permission entry\n    \u2193\nIf sharing with user:\n    \u251c\u2500\u2192 Create user-specific permission\n    \u251c\u2500\u2192 Notify user via email\n    \u2514\u2500\u2192 Add to "Shared with me"\n\nIf sharing via link:\n    \u251c\u2500\u2192 Generate unique share link\n    \u251c\u2500\u2192 Store link mapping\n    \u2514\u2500\u2192 Return link to user\n    \u2193\nRecipient accesses shared resource\n    \u2193\nPermission Service validates access\n    \u2193\nGrant access based on permission level\n'})}),"\n",(0,s.jsx)(n.h3,{id:"5-conflict-resolution-flow",children:"5. Conflict Resolution Flow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'Device A: Modifies file\nDevice B: Modifies same file (offline)\n    \u2193\nDevice A syncs first\n    \u2193\nCloud version updated (v2)\n    \u2193\nDevice B comes online\n    \u2193\nSync Service detects conflict\n    \u2193\n\u251c\u2500\u2192 Cloud version: v2 (checksum X)\n\u2514\u2500\u2192 Local version: v2 (checksum Y)\n    \u2193\nConflict Resolution Strategy\n    \u2193\n\u251c\u2500\u2192 Keep both versions:\n\u2502   \u251c\u2500\u2192 Rename Device B\'s file\n\u2502   \u2502   "document.txt" \u2192 "document (Device B\'s conflicted copy).txt"\n\u2502   \u2514\u2500\u2192 Upload as new file\n\u2502\n\u251c\u2500\u2192 Last-writer-wins (if configured):\n\u2502   \u2514\u2500\u2192 Overwrite with latest timestamp\n\u2502\n\u2514\u2500\u2192 Manual resolution:\n    \u2514\u2500\u2192 Prompt user to choose version\n    \u2193\nUpdate sync metadata\n    \u2193\nNotify all devices\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"high-level-design",children:"High-Level Design"}),"\n",(0,s.jsx)(n.h3,{id:"system-architecture",children:"System Architecture"}),"\n",(0,s.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Client Layer"\n        WEB[Web Browser]\n        MOBILE[Mobile App]\n        DESKTOP[Desktop Client]\n        API_CLIENT[API Client]\n    end\n\n    subgraph "CDN Layer"\n        CDN[CDN - CloudFront<br/>Static & Popular Files]\n    end\n\n    subgraph "Load Balancer"\n        LB[Application Load Balancer<br/>SSL Termination]\n    end\n\n    subgraph "API Gateway"\n        GATEWAY[API Gateway<br/>Auth, Rate Limiting, Routing]\n    end\n\n    subgraph "Microservices Layer"\n        AUTH[Auth Service]\n        METADATA[Metadata Service]\n        STORAGE[Storage Service]\n        SYNC[Sync Service]\n        PERMISSION[Permission Service]\n        NOTIFICATION[Notification Service]\n        SEARCH[Search Service]\n        PREVIEW[Preview Service]\n        TRASH[Trash Service]\n    end\n\n    subgraph "Message Queue"\n        KAFKA[Kafka<br/>Upload/Sync/Notification Queues]\n    end\n\n    subgraph "Cache Layer"\n        REDIS[Redis Cluster<br/>Metadata & Sessions]\n        MEMCACHED[Memcached<br/>Distributed Cache]\n    end\n\n    subgraph "Database Layer"\n        POSTGRES_PRIMARY[(PostgreSQL Primary<br/>Users, Files, Folders)]\n        POSTGRES_REPLICA[(PostgreSQL Replicas<br/>Read Operations)]\n        CASSANDRA[(Cassandra<br/>Sync Events)]\n        ELASTICSEARCH[(Elasticsearch<br/>Search Index)]\n    end\n\n    subgraph "Storage Layer"\n        S3_HOT[S3 Hot Tier<br/>Frequent Access]\n        S3_WARM[S3 Warm Tier<br/>Infrequent Access]\n        S3_COLD[S3 Cold Tier<br/>Archive]\n    end\n\n    subgraph "Real-time Layer"\n        WEBSOCKET[WebSocket Server<br/>Live Sync]\n        PUSH[Push Notification<br/>Mobile Alerts]\n    end\n\n    WEB --\x3e CDN\n    MOBILE --\x3e CDN\n    DESKTOP --\x3e CDN\n    API_CLIENT --\x3e CDN\n\n    CDN --\x3e LB\n    LB --\x3e GATEWAY\n\n    GATEWAY --\x3e AUTH\n    GATEWAY --\x3e METADATA\n    GATEWAY --\x3e STORAGE\n    GATEWAY --\x3e SYNC\n    GATEWAY --\x3e PERMISSION\n    GATEWAY --\x3e NOTIFICATION\n    GATEWAY --\x3e SEARCH\n    GATEWAY --\x3e PREVIEW\n    GATEWAY --\x3e TRASH\n\n    STORAGE --\x3e KAFKA\n    SYNC --\x3e KAFKA\n    NOTIFICATION --\x3e KAFKA\n\n    AUTH --\x3e REDIS\n    METADATA --\x3e REDIS\n    PERMISSION --\x3e REDIS\n    SEARCH --\x3e REDIS\n\n    AUTH --\x3e POSTGRES_PRIMARY\n    METADATA --\x3e POSTGRES_PRIMARY\n    PERMISSION --\x3e POSTGRES_PRIMARY\n\n    METADATA --\x3e POSTGRES_REPLICA\n    SEARCH --\x3e POSTGRES_REPLICA\n\n    SYNC --\x3e CASSANDRA\n    SEARCH --\x3e ELASTICSEARCH\n\n    STORAGE --\x3e S3_HOT\n    STORAGE --\x3e S3_WARM\n    STORAGE --\x3e S3_COLD\n\n    NOTIFICATION --\x3e WEBSOCKET\n    NOTIFICATION --\x3e PUSH\n\n    POSTGRES_PRIMARY --\x3e POSTGRES_REPLICA\n\n    style WEB fill:#e1f5ff\n    style MOBILE fill:#e1f5ff\n    style DESKTOP fill:#e1f5ff\n    style CDN fill:#fff3e0\n    style GATEWAY fill:#f3e5f5\n    style KAFKA fill:#fce4ec\n    style REDIS fill:#ffebee\n    style POSTGRES_PRIMARY fill:#e8f5e9\n    style S3_HOT fill:#fff9c4'}),"\n",(0,s.jsx)(n.h3,{id:"component-responsibilities",children:"Component Responsibilities"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. Client Layer"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Web, mobile, and desktop applications"}),"\n",(0,s.jsx)(n.li,{children:"Local file system monitoring (desktop)"}),"\n",(0,s.jsx)(n.li,{children:"Chunked upload/download"}),"\n",(0,s.jsx)(n.li,{children:"Offline support with local cache"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. CDN Layer"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cache static assets and popular files"}),"\n",(0,s.jsx)(n.li,{children:"Edge location serving for low latency"}),"\n",(0,s.jsx)(n.li,{children:"Reduce origin server load"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"3. Load Balancer"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Distribute traffic across API gateways"}),"\n",(0,s.jsx)(n.li,{children:"SSL/TLS termination"}),"\n",(0,s.jsx)(n.li,{children:"Health checks and automatic failover"}),"\n",(0,s.jsx)(n.li,{children:"Geographic routing"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"4. API Gateway"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Centralized authentication and authorization"}),"\n",(0,s.jsx)(n.li,{children:"Rate limiting per user/IP"}),"\n",(0,s.jsx)(n.li,{children:"Request validation"}),"\n",(0,s.jsx)(n.li,{children:"API versioning"}),"\n",(0,s.jsx)(n.li,{children:"Request routing to microservices"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"5. Microservices"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Auth Service"}),": User authentication, JWT token management, OAuth integration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Metadata Service"}),": File/folder metadata CRUD, hierarchy management, version tracking"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Storage Service"}),": Handle file uploads/downloads, chunking, deduplication"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sync Service"}),": Track device sync state, detect changes, conflict resolution"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Permission Service"}),": Manage access control, sharing, link generation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Notification Service"}),": Push notifications, email alerts, WebSocket updates"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Search Service"}),": Index files, full-text search, filter and sort"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Preview Service"}),": Generate thumbnails, document previews, image processing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Trash Service"}),": Soft delete management, trash retention, permanent deletion"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"6. Message Queue"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Decouple services"}),"\n",(0,s.jsx)(n.li,{children:"Async processing (uploads, sync, notifications)"}),"\n",(0,s.jsx)(n.li,{children:"Guaranteed delivery"}),"\n",(0,s.jsx)(n.li,{children:"Load smoothing"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"7. Cache Layer"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Redis"}),": Hot metadata (file info, folder structure, user sessions)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Memcached"}),": Distributed session store"]}),"\n",(0,s.jsx)(n.li,{children:"Reduce database load"}),"\n",(0,s.jsx)(n.li,{children:"Fast read operations"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"8. Database Layer"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PostgreSQL"}),": Relational data (users, files, folders, permissions)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Read Replicas"}),": Scale read operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cassandra"}),": High-write throughput (sync events, activity logs)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Elasticsearch"}),": Full-text search indexing"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"9. Object Storage"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Hot Tier"}),": Frequently accessed files"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Warm Tier"}),": Infrequently accessed files"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cold Tier"}),": Archive storage"]}),"\n",(0,s.jsx)(n.li,{children:"11 nines durability"}),"\n",(0,s.jsx)(n.li,{children:"Versioning support"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"10. Real-time Communication"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"WebSocket for live sync notifications"}),"\n",(0,s.jsx)(n.li,{children:"Push notifications for mobile"}),"\n",(0,s.jsx)(n.li,{children:"Server-sent events for web"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"deep-dives",children:"Deep Dives"}),"\n",(0,s.jsx)(n.h3,{id:"deep-dive-1-file-upload-system",children:"Deep Dive 1: File Upload System"}),"\n",(0,s.jsx)(n.h4,{id:"upload-architecture",children:"Upload Architecture"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Chunked Upload Strategy"})}),"\n",(0,s.jsx)(n.p,{children:"For large files, implement resumable chunked uploads:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Client-side chunking"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Split file into chunks (e.g., 4MB each)"}),"\n",(0,s.jsx)(n.li,{children:"Calculate checksum for each chunk"}),"\n",(0,s.jsx)(n.li,{children:"Calculate overall file checksum"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Upload initialization"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Client requests upload session from Metadata Service"}),"\n",(0,s.jsx)(n.li,{children:"Metadata Service generates upload_id and pre-signed URLs"}),"\n",(0,s.jsx)(n.li,{children:"Return chunk upload URLs to client"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Parallel chunk upload"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Client uploads chunks concurrently (e.g., 4-6 parallel connections)"}),"\n",(0,s.jsx)(n.li,{children:"Each chunk uploaded to Object Storage directly"}),"\n",(0,s.jsx)(n.li,{children:"Resume failed chunks without re-uploading entire file"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Upload completion"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Client notifies completion"}),"\n",(0,s.jsx)(n.li,{children:"Storage Service verifies all chunks received"}),"\n",(0,s.jsx)(n.li,{children:"Assembles chunks or stores chunk metadata"}),"\n",(0,s.jsx)(n.li,{children:"Updates file status in metadata database"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Deduplication"})}),"\n",(0,s.jsx)(n.p,{children:"Implement content-based deduplication:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Block-level deduplication"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Calculate SHA-256 hash for each chunk"}),"\n",(0,s.jsx)(n.li,{children:"Check if chunk hash exists in storage"}),"\n",(0,s.jsx)(n.li,{children:"If exists, create reference pointer instead of storing duplicate"}),"\n",(0,s.jsx)(n.li,{children:"Store only unique chunks"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Benefits"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Reduce storage costs by 30-50%"}),"\n",(0,s.jsx)(n.li,{children:"Faster uploads for duplicate content"}),"\n",(0,s.jsx)(n.li,{children:"Efficient for common files (photos, documents)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Upload Flow Diagram"})}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Client\n    participant API Gateway\n    participant Metadata Service\n    participant Storage Service\n    participant Object Storage\n    participant Message Queue\n\n    Client->>API Gateway: 1. Initialize Upload Request\n    API Gateway->>Metadata Service: 2. Validate & Create Session\n    Metadata Service->>Metadata Service: 3. Generate upload_id & URLs\n    Metadata Service--\x3e>Client: 4. Return Session (upload_id, chunk URLs)\n\n    par Upload Chunks in Parallel\n        Client->>Object Storage: 5a. Upload Chunk 1\n        Client->>Object Storage: 5b. Upload Chunk 2\n        Client->>Object Storage: 5c. Upload Chunk N\n    end\n\n    Client->>API Gateway: 6. Complete Upload Request\n    API Gateway->>Storage Service: 7. Verify All Chunks\n    Storage Service->>Object Storage: 8. Check Chunk Integrity\n    Object Storage--\x3e>Storage Service: 9. Confirmation\n    Storage Service->>Storage Service: 10. Assemble/Store Metadata\n    Storage Service->>Metadata Service: 11. Update File Status\n    Metadata Service->>Message Queue: 12. Publish Sync Event\n    Storage Service--\x3e>Client: 13. Upload Complete Response"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Storage Optimization"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Compression"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Compress text-based files (documents, code)"}),"\n",(0,s.jsx)(n.li,{children:"Smart compression for images (detect already compressed formats)"}),"\n",(0,s.jsx)(n.li,{children:"Video transcoding for streaming"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Tiered Storage"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Hot: Files accessed in last 30 days (SSD-backed)"}),"\n",(0,s.jsx)(n.li,{children:"Warm: Files accessed in last 90 days (Standard storage)"}),"\n",(0,s.jsx)(n.li,{children:"Cold: Files not accessed in 90+ days (Archive storage)"}),"\n",(0,s.jsx)(n.li,{children:"Automatic lifecycle policies"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"deep-dive-2-synchronization-service",children:"Deep Dive 2: Synchronization Service"}),"\n",(0,s.jsx)(n.h4,{id:"sync-architecture",children:"Sync Architecture"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Change Detection"})}),"\n",(0,s.jsx)(n.p,{children:"Multiple strategies for detecting file changes:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"File System Monitoring (Desktop Client)"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use OS-specific APIs (inotify on Linux, FSEvents on macOS, ReadDirectoryChangesW on Windows)"}),"\n",(0,s.jsx)(n.li,{children:"Watch for CREATE, MODIFY, DELETE, RENAME events"}),"\n",(0,s.jsx)(n.li,{children:"Debounce rapid changes (e.g., wait 1 second of inactivity)"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Polling (Mobile/Web)"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Long-polling or periodic polling"}),"\n",(0,s.jsx)(n.li,{children:"Fetch changes since last sync timestamp"}),"\n",(0,s.jsx)(n.li,{children:"Delta sync to minimize data transfer"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Push Notifications"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Server pushes changes to connected clients via WebSocket"}),"\n",(0,s.jsx)(n.li,{children:"Immediate notification for multi-device sync"}),"\n",(0,s.jsx)(n.li,{children:"Fallback to polling if WebSocket unavailable"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Change Propagation Flow"})}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Device A\n    participant Desktop Client A\n    participant Sync Service\n    participant Message Queue\n    participant Cassandra\n    participant WebSocket Server\n    participant Device B\n    participant Desktop Client B\n\n    Device A->>Desktop Client A: 1. User modifies file\n    Desktop Client A->>Desktop Client A: 2. Detect change & calculate checksum\n    Desktop Client A->>Sync Service: 3. Upload modified file\n    Sync Service->>Sync Service: 4. Create change event\n    Sync Service->>Cassandra: 5. Store event\n    Sync Service->>Message Queue: 6. Publish sync notification\n    Message Queue->>WebSocket Server: 7. Forward notification\n    WebSocket Server->>Desktop Client B: 8. Push change event (real-time)\n    Desktop Client B->>Desktop Client B: 9. Compare checksums\n    Desktop Client B->>Sync Service: 10. Download modified file\n    Sync Service--\x3e>Desktop Client B: 11. Stream file data\n    Desktop Client B->>Device B: 12. Apply changes locally\n    Desktop Client B->>Sync Service: 13. Acknowledge sync"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Conflict Resolution"})}),"\n",(0,s.jsx)(n.p,{children:"Multi-strategy conflict handling:"}),"\n",(0,s.jsx)(n.mermaid,{value:"flowchart TD\n    A[Device A & B<br/>modify same file offline] --\x3e B[Both devices<br/>come online]\n    B --\x3e C{Sync Service<br/>detects conflict}\n    C --\x3e|Version Mismatch| D[Analyze Conflict]\n\n    D --\x3e E{Resolution Strategy}\n\n    E --\x3e|Keep Both| F[Rename Device B's file<br/>document conflicted copy.txt]\n    F --\x3e G[Upload both versions]\n    G --\x3e H[Notify user about conflict]\n\n    E --\x3e|Last Writer Wins| I[Compare timestamps]\n    I --\x3e J[Keep latest version]\n    J --\x3e K[Discard older version]\n\n    E --\x3e|Manual Resolution| L[Present both versions to user]\n    L --\x3e M[User chooses version]\n    M --\x3e N[Apply user's choice]\n\n    H --\x3e O[Update sync metadata]\n    K --\x3e O\n    N --\x3e O\n    O --\x3e P[Broadcast to all devices]"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Sync Optimization"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Delta Sync"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Only sync changed blocks, not entire file"}),"\n",(0,s.jsx)(n.li,{children:"Use rsync algorithm or binary diff"}),"\n",(0,s.jsx)(n.li,{children:"Reduce bandwidth by 80-90% for large file modifications"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Batch Sync"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Group multiple small file changes"}),"\n",(0,s.jsx)(n.li,{children:"Single sync request for batch"}),"\n",(0,s.jsx)(n.li,{children:"Reduce API calls and overhead"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Sync Prioritization"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Prioritize recent files"}),"\n",(0,s.jsx)(n.li,{children:"Prioritize starred/important files"}),"\n",(0,s.jsx)(n.li,{children:"Background sync for old files"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Bandwidth Management"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Adaptive bandwidth throttling"}),"\n",(0,s.jsx)(n.li,{children:"Pause/resume sync"}),"\n",(0,s.jsx)(n.li,{children:"Sync scheduling (night-time for large files)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"deep-dive-3-metadata-management",children:"Deep Dive 3: Metadata Management"}),"\n",(0,s.jsx)(n.h4,{id:"metadata-architecture",children:"Metadata Architecture"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Metadata Storage Strategy"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Hot Metadata (Redis)"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Recently accessed file/folder metadata"}),"\n",(0,s.jsx)(n.li,{children:"User session data"}),"\n",(0,s.jsx)(n.li,{children:"Permission cache"}),"\n",(0,s.jsx)(n.li,{children:"TTL: 1 hour"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Warm Metadata (PostgreSQL)"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Complete file/folder hierarchy"}),"\n",(0,s.jsx)(n.li,{children:"User information"}),"\n",(0,s.jsx)(n.li,{children:"Permissions"}),"\n",(0,s.jsx)(n.li,{children:"File versions"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cold Metadata (Archive)"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Deleted files metadata (trash)"}),"\n",(0,s.jsx)(n.li,{children:"Old versions metadata"}),"\n",(0,s.jsx)(n.li,{children:"Audit logs"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Folder Hierarchy Representation"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Approach 1: Adjacency List"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Each folder stores parent_folder_id"}),"\n",(0,s.jsx)(n.li,{children:"Simple inserts and updates"}),"\n",(0,s.jsx)(n.li,{children:"Inefficient for retrieving full path"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Approach 2: Materialized Path"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Store full path: ",(0,s.jsx)(n.code,{children:"/root/folder1/folder2/"})]}),"\n",(0,s.jsx)(n.li,{children:"Fast path retrieval"}),"\n",(0,s.jsx)(n.li,{children:"Complex updates when renaming parent"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Approach 3: Nested Set Model"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Store left and right boundaries"}),"\n",(0,s.jsx)(n.li,{children:"Efficient subtree queries"}),"\n",(0,s.jsx)(n.li,{children:"Complex inserts/deletes"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Recommended: Hybrid Approach"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use Adjacency List in PostgreSQL"}),"\n",(0,s.jsx)(n.li,{children:"Cache materialized paths in Redis"}),"\n",(0,s.jsx)(n.li,{children:"Regenerate cache on path changes"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Metadata Operations"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"List Folder Contents"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Query: ",(0,s.jsx)(n.code,{children:"SELECT * FROM files WHERE parent_folder_id = ? AND is_deleted = false"})]}),"\n",(0,s.jsxs)(n.li,{children:["Cache result in Redis with key: ",(0,s.jsx)(n.code,{children:"folder:contents:{folder_id}"})]}),"\n",(0,s.jsx)(n.li,{children:"Invalidate cache on any child modification"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Get Full Path"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Recursive query up parent hierarchy"}),"\n",(0,s.jsxs)(n.li,{children:["Cache path in Redis: ",(0,s.jsx)(n.code,{children:"folder:path:{folder_id}"})," \u2192 ",(0,s.jsx)(n.code,{children:"/path/to/folder"})]}),"\n",(0,s.jsx)(n.li,{children:"Eager cache regeneration on rename"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Search Files"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Full-text search in Elasticsearch"}),"\n",(0,s.jsx)(n.li,{children:"Index: filename, content (OCR for images), owner, tags"}),"\n",(0,s.jsx)(n.li,{children:"Filter by folder, date range, file type"}),"\n",(0,s.jsx)(n.li,{children:"Return file_ids, fetch metadata from PostgreSQL"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Move File/Folder"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Update parent_folder_id"}),"\n",(0,s.jsx)(n.li,{children:"Check permission in new location"}),"\n",(0,s.jsx)(n.li,{children:"If folder, recursively update all children paths"}),"\n",(0,s.jsx)(n.li,{children:"Invalidate affected caches"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Metadata Consistency"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Write Operations"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Write to PostgreSQL (source of truth)"}),"\n",(0,s.jsx)(n.li,{children:"Invalidate Redis cache"}),"\n",(0,s.jsx)(n.li,{children:"Async update Elasticsearch index"}),"\n",(0,s.jsx)(n.li,{children:"Strong consistency for critical operations"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Read Operations"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Check Redis cache first"}),"\n",(0,s.jsx)(n.li,{children:"Cache miss: Query PostgreSQL"}),"\n",(0,s.jsx)(n.li,{children:"Populate cache with TTL"}),"\n",(0,s.jsx)(n.li,{children:"Eventual consistency acceptable"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Transaction Management"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use database transactions for multi-table updates"}),"\n",(0,s.jsx)(n.li,{children:"Example: Move file = Update file table + Update parent's modified timestamp + Update user's storage"}),"\n",(0,s.jsx)(n.li,{children:"Ensure atomicity"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"deep-dive-4-sharing--permissions",children:"Deep Dive 4: Sharing & Permissions"}),"\n",(0,s.jsx)(n.h4,{id:"permission-model",children:"Permission Model"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Permission Hierarchy"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Owner"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Full control over file/folder"}),"\n",(0,s.jsx)(n.li,{children:"Can delete, rename, share"}),"\n",(0,s.jsx)(n.li,{children:"Can change permissions"}),"\n",(0,s.jsx)(n.li,{children:"Cannot be removed as owner"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Editor"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Can view, comment, and edit"}),"\n",(0,s.jsx)(n.li,{children:"Can upload new versions"}),"\n",(0,s.jsx)(n.li,{children:"Cannot delete or change permissions"}),"\n",(0,s.jsx)(n.li,{children:"Can share with others (if owner allows)"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Commenter"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Can view and add comments"}),"\n",(0,s.jsx)(n.li,{children:"Cannot edit content"}),"\n",(0,s.jsx)(n.li,{children:"Useful for review workflows"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Viewer"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Read-only access"}),"\n",(0,s.jsx)(n.li,{children:"Can view and download"}),"\n",(0,s.jsx)(n.li,{children:"No modification rights"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Inheritance Model"})}),"\n",(0,s.jsx)(n.p,{children:"Permissions cascade down folder hierarchy:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Explicit Permissions"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Directly assigned to file/folder"}),"\n",(0,s.jsx)(n.li,{children:"Takes precedence over inherited permissions"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Inherited Permissions"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Folder permissions apply to all children"}),"\n",(0,s.jsx)(n.li,{children:"Child can have more restrictive permissions"}),"\n",(0,s.jsx)(n.li,{children:"Cannot have more permissive permissions than parent"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Permission Resolution"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Check explicit permission first"}),"\n",(0,s.jsx)(n.li,{children:"If none, traverse up folder hierarchy"}),"\n",(0,s.jsx)(n.li,{children:"Apply most restrictive permission found"}),"\n",(0,s.jsx)(n.li,{children:"Cache permission resolution result"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Sharing Implementation"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Share with Specific Users"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"User A shares file with User B"}),"\n",(0,s.jsxs)(n.li,{children:["Create permission entry: ",(0,s.jsx)(n.code,{children:"{file_id, user_b_id, EDITOR}"})]}),"\n",(0,s.jsx)(n.li,{children:"Send email notification to User B"}),"\n",(0,s.jsx)(n.li,{children:'Add to User B\'s "Shared with me" view'}),"\n",(0,s.jsx)(n.li,{children:"User B can access via shared view or direct link"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Share via Link"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Generate unique share token: ",(0,s.jsx)(n.code,{children:"https://drive.com/share/{token}"})]}),"\n",(0,s.jsxs)(n.li,{children:["Store mapping: ",(0,s.jsx)(n.code,{children:"{token \u2192 file_id, permission_level, expiration}"})]}),"\n",(0,s.jsx)(n.li,{children:"Anyone with link can access (if configured)"}),"\n",(0,s.jsx)(n.li,{children:"Optional: Password protection, expiration date"}),"\n",(0,s.jsx)(n.li,{children:"Track link usage in analytics"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Public Sharing"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Set file/folder as public"}),"\n",(0,s.jsx)(n.li,{children:"Accessible to anyone on internet"}),"\n",(0,s.jsx)(n.li,{children:"Indexable by search engines (optional)"}),"\n",(0,s.jsx)(n.li,{children:"Show warning about public access"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Share Link Security"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Token Generation"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use cryptographically secure random tokens"}),"\n",(0,s.jsx)(n.li,{children:"Minimum 32 characters"}),"\n",(0,s.jsx)(n.li,{children:"Non-guessable URLs"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Access Validation"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Check token exists and not expired"}),"\n",(0,s.jsx)(n.li,{children:"Verify permission level"}),"\n",(0,s.jsx)(n.li,{children:"Rate limit link access (prevent scraping)"}),"\n",(0,s.jsx)(n.li,{children:"Log all access attempts"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Revocation"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Owner can revoke share link instantly"}),"\n",(0,s.jsx)(n.li,{children:"Delete token mapping"}),"\n",(0,s.jsx)(n.li,{children:"All future access attempts fail"}),"\n",(0,s.jsx)(n.li,{children:"Notify affected users (optional)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"deep-dive-5-search--indexing",children:"Deep Dive 5: Search & Indexing"}),"\n",(0,s.jsx)(n.h4,{id:"search-architecture",children:"Search Architecture"}),"\n",(0,s.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Indexing Pipeline"\n        FILE_EVENT[File Upload/Update Event] --\x3e KAFKA[Kafka Queue]\n        KAFKA --\x3e INDEXER[Indexing Worker]\n        INDEXER --\x3e EXTRACTOR{Content Type}\n        EXTRACTOR --\x3e|Document| DOC_EXTRACT[Text Extraction<br/>PDF, DOCX, TXT]\n        EXTRACTOR --\x3e|Image| OCR[OCR Processing<br/>Tesseract/Vision API]\n        EXTRACTOR --\x3e|Video| SUBTITLE[Subtitle Extraction]\n        EXTRACTOR --\x3e|Audio| STT[Speech-to-Text]\n\n        DOC_EXTRACT --\x3e ELASTIC[Elasticsearch]\n        OCR --\x3e ELASTIC\n        SUBTITLE --\x3e ELASTIC\n        STT --\x3e ELASTIC\n\n        INDEXER --\x3e METADATA_EXTRACT[Extract Metadata]\n        METADATA_EXTRACT --\x3e ELASTIC\n    end\n\n    subgraph "Search Query"\n        USER[User Search Query] --\x3e API[Search API]\n        API --\x3e CACHE{Redis Cache}\n        CACHE --\x3e|Hit| RETURN1[Return Results]\n        CACHE --\x3e|Miss| ELASTIC\n        ELASTIC --\x3e RANK[Relevance Ranking]\n        RANK --\x3e CACHE\n        RANK --\x3e RETURN1\n    end\n\n    style FILE_EVENT fill:#e3f2fd\n    style ELASTIC fill:#fff3e0\n    style CACHE fill:#ffebee\n    style RETURN1 fill:#e8f5e9'}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Elasticsearch Index Design"})}),"\n",(0,s.jsx)(n.p,{children:"Index structure for file search:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"file_search_index {\n  file_id: keyword\n  filename: text (analyzed)\n  file_extension: keyword\n  owner_id: keyword\n  owner_name: text\n  parent_path: text\n  mime_type: keyword\n  size: long\n  created_at: date\n  updated_at: date\n  is_starred: boolean\n  is_shared: boolean\n  shared_with: keyword[] (user_ids)\n  tags: keyword[]\n  content: text (for text files)\n  ocr_text: text (for images with OCR)\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Indexing Pipeline"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Real-time Indexing"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"On file upload/update, publish event to Kafka"}),"\n",(0,s.jsx)(n.li,{children:"Indexing worker consumes event"}),"\n",(0,s.jsx)(n.li,{children:"Extract metadata and content"}),"\n",(0,s.jsx)(n.li,{children:"Index in Elasticsearch"}),"\n",(0,s.jsx)(n.li,{children:"Latency: < 2 seconds"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Content Extraction"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Documents"}),": Extract text from PDF, DOCX, TXT"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Images"}),": OCR using Google Vision API or Tesseract"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Videos"}),": Extract subtitles/captions if available"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Audio"}),": Speech-to-text transcription"]}),"\n",(0,s.jsxs)(n.li,{children:["Store extracted content in ",(0,s.jsx)(n.code,{children:"content"})," field"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Incremental Indexing"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Only index changed files"}),"\n",(0,s.jsx)(n.li,{children:"Update existing documents in index"}),"\n",(0,s.jsx)(n.li,{children:"Delete index entries for deleted files"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Search Query Types"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Simple Search"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Search by filename"}),"\n",(0,s.jsxs)(n.li,{children:["Query: ",(0,s.jsx)(n.code,{children:"GET /file_search_index/_search?q=filename:report"})]}),"\n",(0,s.jsx)(n.li,{children:"Fuzzy matching for typos"}),"\n",(0,s.jsx)(n.li,{children:"Autocomplete suggestions"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Advanced Search"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Multi-field search: filename OR content"}),"\n",(0,s.jsx)(n.li,{children:"Filters: file type, owner, date range"}),"\n",(0,s.jsx)(n.li,{children:"Sorting: relevance, date, size"}),"\n",(0,s.jsx)(n.li,{children:"Pagination with scroll API"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Faceted Search"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Aggregations by file type, owner, date"}),"\n",(0,s.jsx)(n.li,{children:"Show counts for each facet"}),"\n",(0,s.jsx)(n.li,{children:"Enable drill-down filtering"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Search Optimization"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Query Performance"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use index sharding (shard by user_id)"}),"\n",(0,s.jsx)(n.li,{children:"Filter before query (reduce search space)"}),"\n",(0,s.jsx)(n.li,{children:"Cache frequent searches"}),"\n",(0,s.jsx)(n.li,{children:"Use result pagination"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Relevance Tuning"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Boost filename matches over content"}),"\n",(0,s.jsx)(n.li,{children:"Boost recent files"}),"\n",(0,s.jsx)(n.li,{children:"Boost files from owner"}),"\n",(0,s.jsx)(n.li,{children:"Custom scoring algorithm"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Search Analytics"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Track popular searches"}),"\n",(0,s.jsx)(n.li,{children:"Identify failed searches (no results)"}),"\n",(0,s.jsx)(n.li,{children:"Improve indexing based on usage patterns"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"deep-dive-6-real-time-collaboration",children:"Deep Dive 6: Real-time Collaboration"}),"\n",(0,s.jsx)(n.h4,{id:"collaborative-editing-architecture",children:"Collaborative Editing Architecture"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Operational Transformation (OT)"})}),"\n",(0,s.jsx)(n.p,{children:"For real-time collaborative document editing:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Basic Concepts"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Multiple users edit same document simultaneously"}),"\n",(0,s.jsx)(n.li,{children:"Each edit is an operation: INSERT, DELETE, REPLACE"}),"\n",(0,s.jsx)(n.li,{children:"Operations are transformed to account for concurrent edits"}),"\n",(0,s.jsx)(n.li,{children:"Ensures all clients converge to same state"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Operation Flow"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'User A types "Hello" at position 0'}),"\n",(0,s.jsxs)(n.li,{children:["Operation: ",(0,s.jsx)(n.code,{children:'{type: INSERT, position: 0, text: "Hello"}'})]}),"\n",(0,s.jsx)(n.li,{children:"Send to server"}),"\n",(0,s.jsx)(n.li,{children:"Server broadcasts to all connected clients"}),"\n",(0,s.jsx)(n.li,{children:"Clients apply operation to local document"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Conflict Resolution"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"User A inserts at position 5"}),"\n",(0,s.jsx)(n.li,{children:"User B deletes at position 3"}),"\n",(0,s.jsx)(n.li,{children:"Operations conflict"}),"\n",(0,s.jsx)(n.li,{children:"OT algorithm transforms operations"}),"\n",(0,s.jsx)(n.li,{children:"Both clients converge to same result"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Real-time Communication"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"WebSocket Connection"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Establish WebSocket on document open"}),"\n",(0,s.jsx)(n.li,{children:"Persistent bidirectional connection"}),"\n",(0,s.jsx)(n.li,{children:"Low latency (< 100ms)"}),"\n",(0,s.jsx)(n.li,{children:"Heartbeat to detect disconnections"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Presence Awareness"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Show active users editing document"}),"\n",(0,s.jsx)(n.li,{children:"Display cursor positions"}),"\n",(0,s.jsx)(n.li,{children:"Show user avatars and colors"}),"\n",(0,s.jsx)(n.li,{children:"Indicate who is typing"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Offline Support"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Queue operations locally when offline"}),"\n",(0,s.jsx)(n.li,{children:"Sync when connection restored"}),"\n",(0,s.jsx)(n.li,{children:"Resolve conflicts with OT"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Document Locking"})}),"\n",(0,s.jsx)(n.p,{children:"For non-collaborative workflows:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pessimistic Locking"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"User requests edit lock"}),"\n",(0,s.jsx)(n.li,{children:"Lock granted if document not locked"}),"\n",(0,s.jsx)(n.li,{children:'Other users see "locked by User X"'}),"\n",(0,s.jsx)(n.li,{children:"Auto-release lock after timeout (30 min)"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Optimistic Locking"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Allow concurrent edits"}),"\n",(0,s.jsx)(n.li,{children:"Detect conflicts on save"}),"\n",(0,s.jsx)(n.li,{children:"Prompt user to resolve conflicts"}),"\n",(0,s.jsx)(n.li,{children:"Merge changes or overwrite"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"database-schema",children:"Database Schema"}),"\n",(0,s.jsx)(n.h3,{id:"postgresql-schema",children:"PostgreSQL Schema"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Users Table"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE users (\n    user_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    email VARCHAR(255) UNIQUE NOT NULL,\n    name VARCHAR(255) NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n    storage_quota BIGINT DEFAULT 15000000000, -- 15GB in bytes\n    storage_used BIGINT DEFAULT 0,\n    is_active BOOLEAN DEFAULT true,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    last_login TIMESTAMP\n);\n\nCREATE INDEX idx_users_email ON users(email);\nCREATE INDEX idx_users_created_at ON users(created_at);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Folders Table"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE folders (\n    folder_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name VARCHAR(255) NOT NULL,\n    parent_folder_id UUID REFERENCES folders(folder_id) ON DELETE CASCADE,\n    owner_id UUID REFERENCES users(user_id) NOT NULL,\n    is_deleted BOOLEAN DEFAULT false,\n    is_starred BOOLEAN DEFAULT false,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    deleted_at TIMESTAMP\n);\n\nCREATE INDEX idx_folders_parent ON folders(parent_folder_id) WHERE is_deleted = false;\nCREATE INDEX idx_folders_owner ON folders(owner_id) WHERE is_deleted = false;\nCREATE INDEX idx_folders_deleted ON folders(deleted_at) WHERE is_deleted = true;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Files Table"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE files (\n    file_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name VARCHAR(255) NOT NULL,\n    parent_folder_id UUID REFERENCES folders(folder_id),\n    owner_id UUID REFERENCES users(user_id) NOT NULL,\n    size BIGINT NOT NULL,\n    mime_type VARCHAR(127),\n    storage_path VARCHAR(1023) NOT NULL,\n    checksum VARCHAR(64) NOT NULL, -- SHA-256\n    version INTEGER DEFAULT 1,\n    is_deleted BOOLEAN DEFAULT false,\n    is_starred BOOLEAN DEFAULT false,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    deleted_at TIMESTAMP\n);\n\nCREATE INDEX idx_files_parent ON files(parent_folder_id) WHERE is_deleted = false;\nCREATE INDEX idx_files_owner ON files(owner_id) WHERE is_deleted = false;\nCREATE INDEX idx_files_checksum ON files(checksum); -- For deduplication\nCREATE INDEX idx_files_deleted ON files(deleted_at) WHERE is_deleted = true;\nCREATE INDEX idx_files_updated ON files(updated_at DESC);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"File Versions Table"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE file_versions (\n    version_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    file_id UUID REFERENCES files(file_id) ON DELETE CASCADE,\n    version_number INTEGER NOT NULL,\n    size BIGINT NOT NULL,\n    storage_path VARCHAR(1023) NOT NULL,\n    checksum VARCHAR(64) NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    created_by UUID REFERENCES users(user_id),\n    UNIQUE(file_id, version_number)\n);\n\nCREATE INDEX idx_versions_file ON file_versions(file_id, version_number DESC);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Permissions Table"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE permissions (\n    permission_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    resource_id UUID NOT NULL, -- file_id or folder_id\n    resource_type VARCHAR(10) NOT NULL CHECK (resource_type IN ('FILE', 'FOLDER')),\n    user_id UUID REFERENCES users(user_id), -- NULL for public/link shares\n    permission_type VARCHAR(10) NOT NULL CHECK (permission_type IN ('OWNER', 'EDITOR', 'COMMENTER', 'VIEWER')),\n    is_public BOOLEAN DEFAULT false,\n    share_token VARCHAR(64) UNIQUE, -- For shareable links\n    share_password_hash VARCHAR(255), -- Optional password protection\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    expires_at TIMESTAMP, -- Optional expiration\n    created_by UUID REFERENCES users(user_id)\n);\n\nCREATE INDEX idx_permissions_resource ON permissions(resource_id, resource_type);\nCREATE INDEX idx_permissions_user ON permissions(user_id);\nCREATE INDEX idx_permissions_token ON permissions(share_token) WHERE share_token IS NOT NULL;\nCREATE INDEX idx_permissions_public ON permissions(is_public) WHERE is_public = true;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Sync Metadata Table"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE sync_metadata (\n    sync_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(user_id) NOT NULL,\n    device_id VARCHAR(255) NOT NULL,\n    device_name VARCHAR(255),\n    file_id UUID REFERENCES files(file_id),\n    local_path VARCHAR(1023),\n    last_synced TIMESTAMP,\n    sync_status VARCHAR(20) CHECK (sync_status IN ('SYNCED', 'PENDING', 'CONFLICT', 'ERROR')),\n    checksum VARCHAR(64),\n    UNIQUE(user_id, device_id, file_id)\n);\n\nCREATE INDEX idx_sync_user_device ON sync_metadata(user_id, device_id);\nCREATE INDEX idx_sync_status ON sync_metadata(sync_status) WHERE sync_status != 'SYNCED';\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Shared With Me View"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE VIEW shared_with_me AS\nSELECT\n    p.permission_id,\n    p.resource_id,\n    p.resource_type,\n    p.permission_type,\n    p.created_at as shared_at,\n    u.user_id as owner_id,\n    u.name as owner_name,\n    CASE\n        WHEN p.resource_type = 'FILE' THEN f.name\n        WHEN p.resource_type = 'FOLDER' THEN fo.name\n    END as resource_name\nFROM permissions p\nLEFT JOIN files f ON p.resource_id = f.file_id AND p.resource_type = 'FILE'\nLEFT JOIN folders fo ON p.resource_id = fo.folder_id AND p.resource_type = 'FOLDER'\nLEFT JOIN users u ON f.owner_id = u.user_id OR fo.owner_id = u.user_id\nWHERE p.user_id IS NOT NULL;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cassandra-schema-for-sync-events",children:"Cassandra Schema (for Sync Events)"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Sync Events Table"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"CREATE TABLE sync_events (\n    user_id UUID,\n    event_id TIMEUUID,\n    event_type TEXT, -- CREATE, UPDATE, DELETE, RENAME, MOVE\n    resource_id UUID,\n    resource_type TEXT, -- FILE, FOLDER\n    device_id TEXT,\n    checksum TEXT,\n    old_path TEXT,\n    new_path TEXT,\n    timestamp TIMESTAMP,\n    PRIMARY KEY ((user_id), event_id)\n) WITH CLUSTERING ORDER BY (event_id DESC)\nAND default_time_to_live = 2592000; -- 30 days TTL\n"})}),"\n",(0,s.jsx)(n.h3,{id:"redis-cache-schema",children:"Redis Cache Schema"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cache Keys"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"# User session\nsession:{user_id} \u2192 {token, device_id, expires_at}\n\n# File metadata\nfile:metadata:{file_id} \u2192 {name, size, mime_type, owner_id, ...}\n\n# Folder contents\nfolder:contents:{folder_id} \u2192 [{file_id, name, size}, ...]\n\n# User storage\nuser:storage:{user_id} \u2192 {quota, used, percentage}\n\n# Permissions cache\npermission:{user_id}:{resource_id} \u2192 {permission_type}\n\n# Share token mapping\nshare:token:{token} \u2192 {resource_id, resource_type, permission_type, expires_at}\n\n# Recent files per user\nuser:recent:{user_id} \u2192 [file_id1, file_id2, ...] (ordered list, max 50)\n\n# Sync cursor (for delta sync)\nsync:cursor:{user_id}:{device_id} \u2192 {last_event_id, timestamp}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"capacity-estimation",children:"Capacity Estimation"}),"\n",(0,s.jsx)(n.h3,{id:"traffic-estimates",children:"Traffic Estimates"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Assumptions:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Total users: 1 billion"}),"\n",(0,s.jsx)(n.li,{children:"Daily Active Users (DAU): 100 million (10%)"}),"\n",(0,s.jsx)(n.li,{children:"Average files per user: 1000"}),"\n",(0,s.jsx)(n.li,{children:"Average file size: 2 MB"}),"\n",(0,s.jsx)(n.li,{children:"Daily uploads per active user: 5 files"}),"\n",(0,s.jsx)(n.li,{children:"Daily downloads per active user: 10 files"}),"\n",(0,s.jsxs)(n.li,{children:["Read",":Write"," ratio: 70:30"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Daily Metrics:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Daily Uploads:\n100M users \xd7 5 uploads = 500M uploads/day\n500M / 86400 = ~5,787 uploads/sec (average)\nPeak (3x average) = ~17,361 uploads/sec\n\nDaily Downloads:\n100M users \xd7 10 downloads = 1B downloads/day\n1B / 86400 = ~11,574 downloads/sec (average)\nPeak = ~34,722 downloads/sec\n\nMetadata Operations (list, search, etc.):\n100M users \xd7 50 operations = 5B operations/day\n5B / 86400 = ~57,870 ops/sec (average)\nPeak = ~173,610 ops/sec\n"})}),"\n",(0,s.jsx)(n.h3,{id:"storage-estimates",children:"Storage Estimates"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"File Storage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Total users: 1B\nFiles per user: 1,000\nAverage file size: 2 MB\n\nTotal files = 1B \xd7 1,000 = 1 trillion files\nTotal storage = 1T \xd7 2 MB = 2,000 PB = 2 EB (Exabytes)\n\nWith deduplication (40% reduction):\nActual storage = 2 EB \xd7 0.6 = 1.2 EB\n\nDaily new storage:\n500M uploads \xd7 2 MB = 1 PB/day\nAnnual new storage = 365 PB/year\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Metadata Storage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Metadata per file = 1 KB (file_id, name, path, owner, size, etc.)\nTotal files = 1 trillion\nMetadata storage = 1T \xd7 1 KB = 1 TB\n\nWith indexes (3x data size):\nTotal metadata storage = 1 TB \xd7 3 = 3 TB\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Version Storage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Average versions per file: 3\nVersion metadata: 500 bytes\nTotal version storage = 1T files \xd7 3 versions \xd7 500 bytes = 1.5 TB\n\nVersion file storage (20% of files have multiple versions):\n0.2 \xd7 1T \xd7 2 versions \xd7 2 MB = 800 PB\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Total Storage (with replication factor 3):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"File storage: 1.2 EB \xd7 3 = 3.6 EB\nMetadata: 3 TB \xd7 3 = 9 TB\nVersions: 800 PB \xd7 3 = 2.4 PB\nTotal: ~3.6 EB\n"})}),"\n",(0,s.jsx)(n.h3,{id:"bandwidth-estimates",children:"Bandwidth Estimates"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Incoming (Upload):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Average: 5,787 uploads/sec \xd7 2 MB = 11.5 GB/sec = 92 Gbps\nPeak: 17,361 uploads/sec \xd7 2 MB = 34.7 GB/sec = 278 Gbps\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Outgoing (Download):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Average: 11,574 downloads/sec \xd7 2 MB = 23.1 GB/sec = 185 Gbps\nPeak: 34,722 downloads/sec \xd7 2 MB = 69.4 GB/sec = 555 Gbps\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Metadata API:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Average: 57,870 ops/sec \xd7 10 KB = 578 MB/sec = 4.6 Gbps\nPeak: 173,610 ops/sec \xd7 10 KB = 1.7 GB/sec = 13.6 Gbps\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Total Bandwidth:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Average: 92 + 185 + 4.6 = 281.6 Gbps\nPeak: 278 + 555 + 13.6 = 846.6 Gbps \u2248 850 Gbps\n"})}),"\n",(0,s.jsx)(n.h3,{id:"memory-estimates",children:"Memory Estimates"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cache Requirements:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"# Hot metadata cache (1% of files accessed frequently)\nHot files = 1T \xd7 0.01 = 10B files\nMetadata per file = 1 KB\nCache size = 10B \xd7 1 KB = 10 TB\n\n# Session cache\nConcurrent users = 10M\nSession data = 1 KB per user\nTotal = 10M \xd7 1 KB = 10 GB\n\n# Permission cache (hot permissions)\nHot permissions = 100M\nPer permission = 200 bytes\nTotal = 100M \xd7 200 bytes = 20 GB\n\nTotal cache requirement: 10 TB + 10 GB + 20 GB \u2248 10 TB\n"})}),"\n",(0,s.jsx)(n.h3,{id:"server-estimates",children:"Server Estimates"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"API Servers:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Total requests per second (peak): 173,610 ops/sec\nRequests per server: 1,000 req/sec\nRequired servers: 173,610 / 1,000 = 174 servers\nWith redundancy (2x): 350 servers\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Upload Workers:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Peak uploads: 17,361 uploads/sec\nAverage upload time: 10 seconds (with chunking)\nConcurrent uploads: 17,361 \xd7 10 = 173,610\nWorkers per upload: 1\nRequired workers: 174,000 workers (scaled dynamically)\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Database Servers:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"PostgreSQL (Metadata):\n- Primary: 1 large instance (write)\n- Read replicas: 50 instances (read-heavy workload)\n\nCassandra (Sync Events):\n- 100 nodes (for high write throughput)\n- Replication factor: 3\n\nElasticsearch (Search):\n- 200 nodes (sharded by user_id)\n- 50 billion documents indexed\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Storage Servers:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Object storage (S3-compatible):\n- Distributed across multiple regions\n- Multiple storage tiers (hot, warm, cold)\n- Automatic replication and durability\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"scalability--optimization",children:"Scalability & Optimization"}),"\n",(0,s.jsx)(n.h3,{id:"horizontal-scaling-strategies",children:"Horizontal Scaling Strategies"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. Database Sharding"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Metadata Sharding (PostgreSQL):"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Shard by user_id using consistent hashing"}),"\n",(0,s.jsx)(n.li,{children:"Each shard contains subset of users"}),"\n",(0,s.jsx)(n.li,{children:"100 shards to distribute load"}),"\n",(0,s.jsxs)(n.li,{children:["Shard key: ",(0,s.jsx)(n.code,{children:"user_id % 100"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Sync Event Sharding (Cassandra):"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Naturally sharded by partition key (user_id)"}),"\n",(0,s.jsx)(n.li,{children:"Add nodes as users grow"}),"\n",(0,s.jsx)(n.li,{children:"Automatic rebalancing"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Search Sharding (Elasticsearch):"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Shard by user_id"}),"\n",(0,s.jsx)(n.li,{children:"500 shards across 200 nodes"}),"\n",(0,s.jsx)(n.li,{children:"Co-locate user's data on same shard for efficiency"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. Service Replication"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Stateless Services:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"API servers, microservices are stateless"}),"\n",(0,s.jsx)(n.li,{children:"Use load balancer to distribute requests"}),"\n",(0,s.jsx)(n.li,{children:"Auto-scale based on CPU/memory/request rate"}),"\n",(0,s.jsx)(n.li,{children:"Kubernetes HPA for dynamic scaling"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Stateful Services:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Database read replicas"}),"\n",(0,s.jsx)(n.li,{children:"Redis cluster with master-slave replication"}),"\n",(0,s.jsx)(n.li,{children:"Cassandra multi-datacenter replication"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"3. Geographic Distribution"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Multi-Region Deployment:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Deploy in multiple AWS regions (us-east-1, eu-west-1, ap-southeast-1)"}),"\n",(0,s.jsx)(n.li,{children:"Users routed to nearest region"}),"\n",(0,s.jsx)(n.li,{children:"Reduce latency by 60-80%"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cross-Region Replication:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Async replication of file data across regions"}),"\n",(0,s.jsx)(n.li,{children:"Metadata replicated with eventual consistency"}),"\n",(0,s.jsx)(n.li,{children:"Sync events propagated globally"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"4. CDN Edge Caching"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Static Content:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cache images, videos, documents at edge locations"}),"\n",(0,s.jsx)(n.li,{children:"300+ edge locations globally"}),"\n",(0,s.jsx)(n.li,{children:"Cache hit ratio: 80%+"}),"\n",(0,s.jsx)(n.li,{children:"Reduce origin load by 80%"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Dynamic Content:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cache file metadata at edge"}),"\n",(0,s.jsx)(n.li,{children:"Cache user sessions"}),"\n",(0,s.jsx)(n.li,{children:"Invalidate on updates"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. Chunked Upload/Download"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Upload Optimization:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Split large files into 4MB chunks"}),"\n",(0,s.jsx)(n.li,{children:"Parallel upload of chunks (6 connections)"}),"\n",(0,s.jsx)(n.li,{children:"Resume failed chunks"}),"\n",(0,s.jsx)(n.li,{children:"Bandwidth utilization: 95%+"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Download Optimization:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Range requests for partial downloads"}),"\n",(0,s.jsx)(n.li,{children:"Parallel chunk downloads"}),"\n",(0,s.jsx)(n.li,{children:"Resume interrupted downloads"}),"\n",(0,s.jsx)(n.li,{children:"Adaptive bitrate for videos"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. Compression"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"File Compression:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Compress text files (GZIP): 70% reduction"}),"\n",(0,s.jsx)(n.li,{children:"Compress images (WebP): 30% reduction"}),"\n",(0,s.jsx)(n.li,{children:"Skip already compressed formats (JPEG, MP4)"}),"\n",(0,s.jsx)(n.li,{children:"Background compression for cold storage"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Network Compression:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"GZIP response compression"}),"\n",(0,s.jsx)(n.li,{children:"Brotli for supported clients"}),"\n",(0,s.jsx)(n.li,{children:"Reduce bandwidth by 60%"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"3. Deduplication"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Block-Level Deduplication:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Calculate SHA-256 for each 4MB chunk"}),"\n",(0,s.jsx)(n.li,{children:"Store unique chunks only"}),"\n",(0,s.jsx)(n.li,{children:"Reference counting for shared chunks"}),"\n",(0,s.jsx)(n.li,{children:"Storage savings: 40-50%"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Reduced storage costs"}),"\n",(0,s.jsx)(n.li,{children:"Faster uploads (skip duplicate chunks)"}),"\n",(0,s.jsx)(n.li,{children:"Efficient backups"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"4. Caching Strategy"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Multi-Level Cache:"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"L1: CDN (Edge)"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Static files, images, videos"}),"\n",(0,s.jsx)(n.li,{children:"TTL: 24 hours"}),"\n",(0,s.jsx)(n.li,{children:"Hit ratio: 80%"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"L2: Application Cache (Redis)"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Hot metadata, permissions"}),"\n",(0,s.jsx)(n.li,{children:"TTL: 1 hour"}),"\n",(0,s.jsx)(n.li,{children:"Hit ratio: 90%"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"L3: Database Query Cache"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Frequently accessed queries"}),"\n",(0,s.jsx)(n.li,{children:"TTL: 5 minutes"}),"\n",(0,s.jsx)(n.li,{children:"Hit ratio: 70%"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cache Invalidation:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Write-through: Update cache on write"}),"\n",(0,s.jsx)(n.li,{children:"Event-driven: Invalidate on file change"}),"\n",(0,s.jsx)(n.li,{children:"TTL-based: Expire old entries"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"5. Database Optimization"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Query Optimization:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Proper indexing on foreign keys"}),"\n",(0,s.jsx)(n.li,{children:"Composite indexes for common queries"}),"\n",(0,s.jsx)(n.li,{children:"Partial indexes for filtered queries"}),"\n",(0,s.jsx)(n.li,{children:"Query plan analysis and optimization"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Connection Pooling:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Pool size: 100 connections per app server"}),"\n",(0,s.jsx)(n.li,{children:"Reuse connections"}),"\n",(0,s.jsx)(n.li,{children:"Reduce connection overhead"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Read/Write Splitting:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Route writes to primary"}),"\n",(0,s.jsx)(n.li,{children:"Route reads to replicas"}),"\n",(0,s.jsx)(n.li,{children:"Load balance across replicas"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"6. Async Processing"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Background Jobs:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"File preview generation"}),"\n",(0,s.jsx)(n.li,{children:"Thumbnail creation"}),"\n",(0,s.jsx)(n.li,{children:"OCR processing"}),"\n",(0,s.jsx)(n.li,{children:"Video transcoding"}),"\n",(0,s.jsx)(n.li,{children:"Search indexing"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Non-blocking user operations"}),"\n",(0,s.jsx)(n.li,{children:"Better resource utilization"}),"\n",(0,s.jsx)(n.li,{children:"Smooth out load spikes"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"availability--reliability",children:"Availability & Reliability"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. High Availability Architecture"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Multi-AZ Deployment:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Deploy across 3 availability zones"}),"\n",(0,s.jsx)(n.li,{children:"Automatic failover on AZ failure"}),"\n",(0,s.jsx)(n.li,{children:"Synchronous replication within region"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Load Balancer:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Active-active load balancers"}),"\n",(0,s.jsx)(n.li,{children:"Health checks every 10 seconds"}),"\n",(0,s.jsx)(n.li,{children:"Automatic removal of unhealthy instances"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Database Failover:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PostgreSQL automatic failover (30 seconds)"}),"\n",(0,s.jsx)(n.li,{children:"Cassandra self-healing (no downtime)"}),"\n",(0,s.jsx)(n.li,{children:"Redis Sentinel for master failover"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. Data Durability"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Replication:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"3x replication for file data"}),"\n",(0,s.jsx)(n.li,{children:"Cross-region async replication"}),"\n",(0,s.jsx)(n.li,{children:"Versioning enabled"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Backups:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Daily full backups"}),"\n",(0,s.jsx)(n.li,{children:"Continuous incremental backups"}),"\n",(0,s.jsx)(n.li,{children:"30-day retention"}),"\n",(0,s.jsx)(n.li,{children:"Point-in-time recovery"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Disaster Recovery:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"RTO (Recovery Time Objective): 1 hour"}),"\n",(0,s.jsx)(n.li,{children:"RPO (Recovery Point Objective): 5 minutes"}),"\n",(0,s.jsx)(n.li,{children:"Regular DR drills"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"3. Monitoring & Alerting"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Metrics:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Upload/download success rate"}),"\n",(0,s.jsx)(n.li,{children:"API latency (p50, p95, p99)"}),"\n",(0,s.jsx)(n.li,{children:"Error rates"}),"\n",(0,s.jsx)(n.li,{children:"Storage usage"}),"\n",(0,s.jsx)(n.li,{children:"Cache hit ratios"}),"\n",(0,s.jsx)(n.li,{children:"Queue depths"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Alerting:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Error rate > 1%"}),"\n",(0,s.jsx)(n.li,{children:"Latency p99 > 5 seconds"}),"\n",(0,s.jsx)(n.li,{children:"Storage > 90% capacity"}),"\n",(0,s.jsx)(n.li,{children:"Queue depth > 10,000"}),"\n",(0,s.jsx)(n.li,{children:"Service health check failures"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"4. Rate Limiting"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Multi-Level Rate Limits:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Per user: 1000 API calls/hour"}),"\n",(0,s.jsx)(n.li,{children:"Per IP: 10,000 requests/hour"}),"\n",(0,s.jsx)(n.li,{children:"Upload: 50 GB/day for free tier"}),"\n",(0,s.jsx)(n.li,{children:"Download: No limit (owned files)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Throttling:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Token bucket algorithm"}),"\n",(0,s.jsx)(n.li,{children:"Exponential backoff on violations"}),"\n",(0,s.jsx)(n.li,{children:"Premium users get higher limits"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"security-measures",children:"Security Measures"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. Encryption"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"At Rest:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"AES-256 encryption for all files"}),"\n",(0,s.jsx)(n.li,{children:"Separate encryption keys per user"}),"\n",(0,s.jsx)(n.li,{children:"Key management service (KMS)"}),"\n",(0,s.jsx)(n.li,{children:"Encrypted database volumes"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"In Transit:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"TLS 1.3 for all connections"}),"\n",(0,s.jsx)(n.li,{children:"Certificate pinning for mobile apps"}),"\n",(0,s.jsx)(n.li,{children:"End-to-end encryption option (client-side)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. Access Control"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Authentication:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"JWT tokens with 1-hour expiry"}),"\n",(0,s.jsx)(n.li,{children:"Refresh tokens with 30-day expiry"}),"\n",(0,s.jsx)(n.li,{children:"Multi-factor authentication (MFA)"}),"\n",(0,s.jsx)(n.li,{children:"OAuth2 integration (Google, Microsoft)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Authorization:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Role-based access control (RBAC)"}),"\n",(0,s.jsx)(n.li,{children:"Permission inheritance"}),"\n",(0,s.jsx)(n.li,{children:"Audit logging of all access"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"3. Malware Scanning"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Upload Scanning:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Scan all uploads with antivirus"}),"\n",(0,s.jsx)(n.li,{children:"Quarantine suspicious files"}),"\n",(0,s.jsx)(n.li,{children:"Notify user and admin"}),"\n",(0,s.jsx)(n.li,{children:"Automatic deletion after review"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"4. DDoS Protection"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Mitigation:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"CloudFlare or AWS Shield"}),"\n",(0,s.jsx)(n.li,{children:"Rate limiting at edge"}),"\n",(0,s.jsx)(n.li,{children:"IP blacklisting"}),"\n",(0,s.jsx)(n.li,{children:"Geographic restrictions"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"5. Compliance"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Regulations:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"GDPR compliance (EU users)"}),"\n",(0,s.jsx)(n.li,{children:"HIPAA compliance (healthcare)"}),"\n",(0,s.jsx)(n.li,{children:"SOC 2 certification"}),"\n",(0,s.jsx)(n.li,{children:"Regular security audits"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Data Residency:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Store EU user data in EU region"}),"\n",(0,s.jsx)(n.li,{children:"Data sovereignty compliance"}),"\n",(0,s.jsx)(n.li,{children:"Right to deletion (GDPR)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"cost-optimization",children:"Cost Optimization"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. Tiered Storage"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Hot Tier (SSD):"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Files accessed in last 30 days"}),"\n",(0,s.jsx)(n.li,{children:"Cost: $0.023/GB/month"}),"\n",(0,s.jsx)(n.li,{children:"Usage: 10% of total storage"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Warm Tier (HDD):"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Files accessed 30-90 days ago"}),"\n",(0,s.jsx)(n.li,{children:"Cost: $0.01/GB/month"}),"\n",(0,s.jsx)(n.li,{children:"Usage: 20% of total storage"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cold Tier (Archive):"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Files not accessed in 90+ days"}),"\n",(0,s.jsx)(n.li,{children:"Cost: $0.004/GB/month"}),"\n",(0,s.jsx)(n.li,{children:"Usage: 70% of total storage"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Savings:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Blended cost: ~$0.008/GB/month"}),"\n",(0,s.jsx)(n.li,{children:"vs. Hot-only: $0.023/GB/month"}),"\n",(0,s.jsx)(n.li,{children:"Cost reduction: 65%"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. Compression"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Storage Savings:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Compress text files: 70% reduction"}),"\n",(0,s.jsx)(n.li,{children:"Compress images: 30% reduction"}),"\n",(0,s.jsx)(n.li,{children:"Overall savings: 40%"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"3. Deduplication"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Savings:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Block-level dedup: 40-50% reduction"}),"\n",(0,s.jsxs)(n.li,{children:["Especially effective for:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Common files (OS files, libraries)"}),"\n",(0,s.jsx)(n.li,{children:"User backups"}),"\n",(0,s.jsx)(n.li,{children:"Multiple uploads of same file"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"4. Spot Instances"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Background processing workers"}),"\n",(0,s.jsx)(n.li,{children:"Batch jobs (transcoding, OCR)"}),"\n",(0,s.jsx)(n.li,{children:"Non-critical workloads"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Savings:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"70-90% cost reduction"}),"\n",(0,s.jsx)(n.li,{children:"Handle interruptions gracefully"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"5. Reserved Instances"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Commit to 1-3 year contracts:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Database servers: 50% savings"}),"\n",(0,s.jsx)(n.li,{children:"Core application servers: 40% savings"}),"\n",(0,s.jsx)(n.li,{children:"Predictable workload"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"estimated-costs-monthly",children:"Estimated Costs (Monthly)"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Compute (Application Servers):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"350 servers \xd7 $200/month = $70,000\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Compute (Workers - Spot Instances):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"1000 workers \xd7 $30/month = $30,000\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Database:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"PostgreSQL: 51 instances \xd7 $500/month = $25,500\nCassandra: 100 nodes \xd7 $300/month = $30,000\nElasticsearch: 200 nodes \xd7 $250/month = $50,000\nRedis: 20 nodes \xd7 $200/month = $4,000\nTotal: $109,500\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Storage (1.2 EB with tiering):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Hot (120 PB): 120,000 TB \xd7 $23 = $2,760,000\nWarm (240 PB): 240,000 TB \xd7 $10 = $2,400,000\nCold (840 PB): 840,000 TB \xd7 $4 = $3,360,000\nTotal: $8,520,000\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Bandwidth (Outgoing - 185 Gbps average):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"~600 PB/month \xd7 $0.05/GB = $30,000,000\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"CDN:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Data transfer: 400 PB/month \xd7 $0.02/GB = $8,000,000\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Monitoring & Logging:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$50,000\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Total Monthly Cost:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Compute: $100,000\nDatabase: $109,500\nStorage: $8,520,000\nBandwidth: $30,000,000\nCDN: $8,000,000\nMisc: $50,000\n\nTotal: ~$46.8 Million/month\nAnnual: ~$561 Million/year\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Revenue Model:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Free tier: 15 GB\nPaid tier: $9.99/month for 100 GB (10M paid users)\nEnterprise: Custom pricing\n\nMonthly revenue: 10M \xd7 $10 = $100M/month\nAnnual revenue: $1.2 Billion/year\nProfit margin: 54%\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.h3,{id:"key-design-decisions",children:"Key Design Decisions"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Microservices Architecture"}),": Independent scaling, fault isolation, technology flexibility"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Object Storage for Files"}),": Durability, scalability, cost-effective at scale"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PostgreSQL for Metadata"}),": ACID compliance, relational integrity, strong consistency"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cassandra for Sync Events"}),": High write throughput, time-series data, eventual consistency"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Elasticsearch for Search"}),": Full-text search, faceted search, fast queries"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Redis for Caching"}),": Hot metadata, sessions, low latency reads"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Chunked Uploads"}),": Resumable, parallel, efficient bandwidth utilization"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Block-Level Deduplication"}),": Storage savings, faster uploads"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tiered Storage"}),": Cost optimization without sacrificing performance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Multi-Region Deployment"}),": Low latency globally, high availability"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"trade-offs",children:"Trade-offs"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Aspect"}),(0,s.jsx)(n.th,{children:"Choice"}),(0,s.jsx)(n.th,{children:"Trade-off"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Storage"}),(0,s.jsx)(n.td,{children:"Object storage"}),(0,s.jsx)(n.td,{children:"Durability & scalability vs. higher latency than block storage"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Metadata"}),(0,s.jsx)(n.td,{children:"PostgreSQL"}),(0,s.jsx)(n.td,{children:"Strong consistency vs. limited write scalability"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Sync"}),(0,s.jsx)(n.td,{children:"Eventual consistency"}),(0,s.jsx)(n.td,{children:"Performance vs. potential temporary inconsistencies"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Deduplication"}),(0,s.jsx)(n.td,{children:"Block-level"}),(0,s.jsx)(n.td,{children:"Storage savings vs. computational overhead"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Caching"}),(0,s.jsx)(n.td,{children:"Aggressive caching"}),(0,s.jsx)(n.td,{children:"Read performance vs. potential stale data"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Sharding"}),(0,s.jsx)(n.td,{children:"User-based"}),(0,s.jsx)(n.td,{children:"Balanced load vs. cross-shard queries complexity"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Replication"}),(0,s.jsx)(n.td,{children:"3x replication"}),(0,s.jsx)(n.td,{children:"Durability vs. 3x storage cost"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"scale-summary",children:"Scale Summary"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"System Capacity:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Users: 1 billion"}),"\n",(0,s.jsx)(n.li,{children:"Daily Active Users: 100 million"}),"\n",(0,s.jsx)(n.li,{children:"Total Files: 1 trillion"}),"\n",(0,s.jsx)(n.li,{children:"Total Storage: 1.2 EB (with deduplication)"}),"\n",(0,s.jsx)(n.li,{children:"Peak Upload Rate: 17,361 files/sec"}),"\n",(0,s.jsx)(n.li,{children:"Peak Download Rate: 34,722 files/sec"}),"\n",(0,s.jsx)(n.li,{children:"Peak API Requests: 173,610 req/sec"}),"\n",(0,s.jsx)(n.li,{children:"Bandwidth: 850 Gbps peak"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Performance Targets:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Upload latency: < 10 seconds (10 MB file)"}),"\n",(0,s.jsx)(n.li,{children:"Download latency: < 5 seconds (10 MB file)"}),"\n",(0,s.jsx)(n.li,{children:"Sync latency: < 2 seconds"}),"\n",(0,s.jsx)(n.li,{children:"API response: < 200ms"}),"\n",(0,s.jsx)(n.li,{children:"Search results: < 500ms"}),"\n",(0,s.jsx)(n.li,{children:"Uptime: 99.99%"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. AI-Powered Features"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Smart search with natural language"}),"\n",(0,s.jsx)(n.li,{children:"Auto-categorization and tagging"}),"\n",(0,s.jsx)(n.li,{children:"Duplicate detection and cleanup"}),"\n",(0,s.jsx)(n.li,{children:"Content recommendations"}),"\n",(0,s.jsx)(n.li,{children:"Intelligent compression"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. Advanced Collaboration"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Video conferencing integration"}),"\n",(0,s.jsx)(n.li,{children:"Whiteboard collaboration"}),"\n",(0,s.jsx)(n.li,{children:"Task management integration"}),"\n",(0,s.jsx)(n.li,{children:"Version comparison and merge tools"}),"\n",(0,s.jsx)(n.li,{children:"Collaborative annotations"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"3. Enhanced Security"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Zero-knowledge encryption"}),"\n",(0,s.jsx)(n.li,{children:"Blockchain-based audit logs"}),"\n",(0,s.jsx)(n.li,{children:"AI-powered anomaly detection"}),"\n",(0,s.jsx)(n.li,{children:"Ransomware protection"}),"\n",(0,s.jsx)(n.li,{children:"Data loss prevention (DLP)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"4. Performance Improvements"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Edge computing for processing"}),"\n",(0,s.jsx)(n.li,{children:"P2P sync between devices"}),"\n",(0,s.jsx)(n.li,{children:"Predictive prefetching"}),"\n",(0,s.jsx)(n.li,{children:"Machine learning for cache optimization"}),"\n",(0,s.jsx)(n.li,{children:"Protocol optimization (QUIC)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"5. Mobile Optimization"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Offline-first architecture"}),"\n",(0,s.jsx)(n.li,{children:"Selective sync"}),"\n",(0,s.jsx)(n.li,{children:"Photo backup optimization"}),"\n",(0,s.jsx)(n.li,{children:"Bandwidth-aware sync"}),"\n",(0,s.jsx)(n.li,{children:"Battery-efficient sync"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"appendix",children:"Appendix"}),"\n",(0,s.jsx)(n.h3,{id:"api-requestresponse-examples",children:"API Request/Response Examples"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. File Upload"})}),"\n",(0,s.jsx)(n.p,{children:"Request:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'POST /api/v1/files/upload\n\nHeaders:\nAuthorization: Bearer {jwt_token}\nContent-Type: multipart/form-data\n\nBody:\n{\n  "file": <binary_data>,\n  "parent_folder_id": "f5a4e3d2-c1b0-4a5e-8d7c-6b5a4e3d2c1b",\n  "name": "document.pdf",\n  "mime_type": "application/pdf"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "file_id": "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d",\n  "name": "document.pdf",\n  "size": 2048576,\n  "mime_type": "application/pdf",\n  "checksum": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",\n  "version": 1,\n  "created_at": "2025-10-07T10:30:00Z",\n  "storage_path": "s3://bucket/users/user123/files/a1b2c3d4.pdf",\n  "upload_status": "COMPLETE"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. Chunked Upload Initialization"})}),"\n",(0,s.jsx)(n.p,{children:"Request:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'POST /api/v1/files/upload/init\n\n{\n  "filename": "large_video.mp4",\n  "file_size": 524288000,\n  "mime_type": "video/mp4",\n  "parent_folder_id": "folder123",\n  "chunk_size": 4194304\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "upload_id": "upload_abc123",\n  "file_id": "file_xyz789",\n  "total_chunks": 125,\n  "chunk_urls": [\n    {\n      "chunk_number": 1,\n      "upload_url": "https://s3.amazonaws.com/presigned-url-1",\n      "expires_at": "2025-10-07T11:30:00Z"\n    },\n    {\n      "chunk_number": 2,\n      "upload_url": "https://s3.amazonaws.com/presigned-url-2",\n      "expires_at": "2025-10-07T11:30:00Z"\n    }\n    // ... more chunks\n  ],\n  "expires_at": "2025-10-07T11:30:00Z"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"3. Complete Chunked Upload"})}),"\n",(0,s.jsx)(n.p,{children:"Request:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'POST /api/v1/files/upload/complete\n\n{\n  "upload_id": "upload_abc123",\n  "file_id": "file_xyz789",\n  "chunks": [\n    {\n      "chunk_number": 1,\n      "checksum": "abc123..."\n    },\n    {\n      "chunk_number": 2,\n      "checksum": "def456..."\n    }\n    // ... all chunks\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "file_id": "file_xyz789",\n  "status": "COMPLETE",\n  "message": "File uploaded successfully",\n  "verification_status": "VERIFIED"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"4. List Folder Contents"})}),"\n",(0,s.jsx)(n.p,{children:"Request:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"GET /api/v1/folders/folder123/contents?page=1&limit=50&sort=name&order=asc\n\nHeaders:\nAuthorization: Bearer {jwt_token}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "folder_id": "folder123",\n  "folder_name": "Documents",\n  "items": [\n    {\n      "type": "FOLDER",\n      "folder_id": "subfolder456",\n      "name": "Work",\n      "created_at": "2025-09-01T10:00:00Z",\n      "updated_at": "2025-10-01T15:30:00Z",\n      "is_shared": false\n    },\n    {\n      "type": "FILE",\n      "file_id": "file789",\n      "name": "report.pdf",\n      "size": 1048576,\n      "mime_type": "application/pdf",\n      "created_at": "2025-10-05T09:15:00Z",\n      "updated_at": "2025-10-05T09:15:00Z",\n      "is_starred": true,\n      "is_shared": true,\n      "thumbnail_url": "https://cdn.example.com/thumbnails/file789.jpg"\n    }\n    // ... more items\n  ],\n  "pagination": {\n    "current_page": 1,\n    "total_pages": 5,\n    "total_items": 247,\n    "items_per_page": 50\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"5. Share File"})}),"\n",(0,s.jsx)(n.p,{children:"Request:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'POST /api/v1/files/file789/share\n\n{\n  "share_with": [\n    {\n      "email": "colleague@example.com",\n      "permission": "EDITOR"\n    }\n  ],\n  "message": "Please review this document",\n  "notify": true\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "file_id": "file789",\n  "shared_with": [\n    {\n      "user_id": "user456",\n      "email": "colleague@example.com",\n      "permission": "EDITOR",\n      "shared_at": "2025-10-07T10:45:00Z"\n    }\n  ],\n  "notification_sent": true\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"6. Generate Share Link"})}),"\n",(0,s.jsx)(n.p,{children:"Request:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'POST /api/v1/files/file789/share-link\n\n{\n  "permission": "VIEWER",\n  "allow_download": true,\n  "expires_in_days": 7,\n  "password_protected": true,\n  "password": "secure123"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "share_link": "https://drive.example.com/share/a1b2c3d4e5f6",\n  "short_link": "https://drv.ex/xyz123",\n  "permission": "VIEWER",\n  "expires_at": "2025-10-14T10:50:00Z",\n  "password_protected": true,\n  "access_count": 0,\n  "created_at": "2025-10-07T10:50:00Z"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"7. Sync Changes (Delta Sync)"})}),"\n",(0,s.jsx)(n.p,{children:"Request:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"GET /api/v1/sync/changes?cursor=abc123xyz&limit=100\n\nHeaders:\nAuthorization: Bearer {jwt_token}\nX-Device-ID: device_abc123\n"})}),"\n",(0,s.jsx)(n.p,{children:"Response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "changes": [\n    {\n      "event_id": "event_001",\n      "event_type": "CREATE",\n      "resource_type": "FILE",\n      "file_id": "file_new123",\n      "name": "newfile.txt",\n      "parent_folder_id": "folder123",\n      "checksum": "sha256_hash",\n      "size": 2048,\n      "timestamp": "2025-10-07T10:55:00Z",\n      "device_id": "device_xyz789"\n    },\n    {\n      "event_id": "event_002",\n      "event_type": "UPDATE",\n      "resource_type": "FILE",\n      "file_id": "file_existing456",\n      "name": "updated.txt",\n      "checksum": "new_sha256_hash",\n      "version": 3,\n      "timestamp": "2025-10-07T10:56:00Z",\n      "device_id": "device_xyz789"\n    },\n    {\n      "event_id": "event_003",\n      "event_type": "DELETE",\n      "resource_type": "FILE",\n      "file_id": "file_deleted789",\n      "timestamp": "2025-10-07T10:57:00Z",\n      "device_id": "device_xyz789"\n    }\n    // ... more changes\n  ],\n  "next_cursor": "def456uvw",\n  "has_more": true,\n  "timestamp": "2025-10-07T10:58:00Z"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"8. Resolve Sync Conflict"})}),"\n",(0,s.jsx)(n.p,{children:"Request:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'POST /api/v1/sync/resolve-conflict\n\n{\n  "file_id": "file_conflict123",\n  "device_id": "device_abc123",\n  "resolution": "KEEP_BOTH",\n  "local_version": {\n    "checksum": "local_sha256",\n    "modified_at": "2025-10-07T10:30:00Z"\n  },\n  "cloud_version": {\n    "checksum": "cloud_sha256",\n    "modified_at": "2025-10-07T10:35:00Z"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "resolution": "KEEP_BOTH",\n  "original_file": {\n    "file_id": "file_conflict123",\n    "name": "document.txt",\n    "checksum": "cloud_sha256"\n  },\n  "conflicted_copy": {\n    "file_id": "file_new_copy456",\n    "name": "document (Device ABC\'s conflicted copy).txt",\n    "checksum": "local_sha256"\n  },\n  "message": "Conflict resolved. Both versions kept."\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"9. Search Files"})}),"\n",(0,s.jsx)(n.p,{children:"Request:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"GET /api/v1/search?q=project+report&type=pdf&owner=me&modified_after=2025-09-01&limit=20\n\nHeaders:\nAuthorization: Bearer {jwt_token}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "query": "project report",\n  "filters": {\n    "type": "pdf",\n    "owner": "me",\n    "modified_after": "2025-09-01"\n  },\n  "results": [\n    {\n      "file_id": "file_search1",\n      "name": "Q3 Project Report.pdf",\n      "parent_path": "/Work/Projects/Q3",\n      "size": 3145728,\n      "modified_at": "2025-09-15T14:20:00Z",\n      "relevance_score": 0.95,\n      "snippet": "...quarterly project report shows significant progress...",\n      "thumbnail_url": "https://cdn.example.com/thumbnails/file_search1.jpg"\n    },\n    {\n      "file_id": "file_search2",\n      "name": "Annual Report Draft.pdf",\n      "parent_path": "/Documents/Reports",\n      "size": 5242880,\n      "modified_at": "2025-10-01T09:30:00Z",\n      "relevance_score": 0.87,\n      "snippet": "...annual project summary and key findings..."\n    }\n    // ... more results\n  ],\n  "facets": {\n    "file_types": {\n      "pdf": 15,\n      "docx": 8,\n      "xlsx": 3\n    },\n    "owners": {\n      "me": 20,\n      "shared": 6\n    },\n    "date_ranges": {\n      "last_week": 5,\n      "last_month": 12,\n      "older": 9\n    }\n  },\n  "total_results": 26,\n  "search_time_ms": 45\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"10. Get Storage Quota"})}),"\n",(0,s.jsx)(n.p,{children:"Request:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"GET /api/v1/storage/quota\n\nHeaders:\nAuthorization: Bearer {jwt_token}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "user_id": "user123",\n  "storage_quota": 107374182400,\n  "storage_used": 32212254720,\n  "storage_used_readable": "30 GB",\n  "storage_quota_readable": "100 GB",\n  "usage_percentage": 30,\n  "breakdown": {\n    "documents": {\n      "size": 5368709120,\n      "size_readable": "5 GB",\n      "percentage": 16.7,\n      "file_count": 1250\n    },\n    "images": {\n      "size": 16106127360,\n      "size_readable": "15 GB",\n      "percentage": 50,\n      "file_count": 3420\n    },\n    "videos": {\n      "size": 8589934592,\n      "size_readable": "8 GB",\n      "percentage": 26.7,\n      "file_count": 45\n    },\n    "others": {\n      "size": 2147483648,\n      "size_readable": "2 GB",\n      "percentage": 6.7,\n      "file_count": 890\n    }\n  },\n  "warning": null\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"websocket-events",children:"WebSocket Events"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Connection Establishment:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Client connects to WebSocket\nws://drive.example.com/sync/ws?token={jwt_token}&device_id={device_id}\n\n// Server confirms connection\n{\n  "type": "CONNECTION_ACK",\n  "device_id": "device_abc123",\n  "user_id": "user123",\n  "timestamp": "2025-10-07T11:00:00Z"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Real-time Sync Notification:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "type": "FILE_CHANGED",\n  "event": {\n    "event_id": "event_123",\n    "event_type": "UPDATE",\n    "file_id": "file_abc",\n    "name": "document.txt",\n    "checksum": "new_hash",\n    "version": 5,\n    "modified_by": "user456",\n    "modified_at": "2025-10-07T11:01:00Z",\n    "device_id": "device_xyz789"\n  },\n  "timestamp": "2025-10-07T11:01:00Z"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Collaboration Notification:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "type": "FILE_SHARED",\n  "file_id": "file_shared123",\n  "name": "Quarterly Report.pdf",\n  "shared_by": {\n    "user_id": "user789",\n    "name": "John Doe",\n    "email": "john@example.com"\n  },\n  "permission": "EDITOR",\n  "message": "Please review and edit",\n  "timestamp": "2025-10-07T11:02:00Z"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"User Presence (for collaborative editing):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "type": "USER_PRESENCE",\n  "file_id": "file_collab456",\n  "users": [\n    {\n      "user_id": "user123",\n      "name": "Alice",\n      "cursor_position": 125,\n      "color": "#FF5733"\n    },\n    {\n      "user_id": "user456",\n      "name": "Bob",\n      "cursor_position": 457,\n      "color": "#33C4FF"\n    }\n  ],\n  "timestamp": "2025-10-07T11:03:00Z"\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Standard Error Response:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "error": {\n    "code": "INSUFFICIENT_STORAGE",\n    "message": "Not enough storage space available",\n    "details": {\n      "required_space": 104857600,\n      "available_space": 52428800,\n      "required_readable": "100 MB",\n      "available_readable": "50 MB"\n    },\n    "timestamp": "2025-10-07T11:05:00Z",\n    "request_id": "req_abc123xyz"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Common Error Codes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"AUTHENTICATION_FAILED"}),": Invalid or expired token"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"PERMISSION_DENIED"}),": User lacks required permission"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"RESOURCE_NOT_FOUND"}),": File or folder not found"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"INSUFFICIENT_STORAGE"}),": Storage quota exceeded"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"FILE_TOO_LARGE"}),": File exceeds size limit"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"RATE_LIMIT_EXCEEDED"}),": Too many requests"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"CONFLICT"}),": Sync conflict detected"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"INVALID_REQUEST"}),": Malformed request"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"INTERNAL_SERVER_ERROR"}),": Server-side error"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"monitoring-metrics",children:"Monitoring Metrics"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"System Health Metrics:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'# Upload metrics\ndrive_uploads_total{status="success"} 5787/sec\ndrive_uploads_total{status="failed"} 12/sec\ndrive_upload_duration_seconds{quantile="0.5"} 2.3\ndrive_upload_duration_seconds{quantile="0.95"} 8.7\ndrive_upload_duration_seconds{quantile="0.99"} 15.2\n\n# Download metrics\ndrive_downloads_total{status="success"} 11574/sec\ndrive_download_duration_seconds{quantile="0.95"} 3.2\n\n# API metrics\ndrive_api_requests_total{endpoint="/files",method="GET",status="200"} 45320/sec\ndrive_api_requests_total{endpoint="/files",method="POST",status="201"} 5787/sec\ndrive_api_request_duration_seconds{endpoint="/files"}{quantile="0.95"} 0.15\n\n# Cache metrics\ndrive_cache_hits_total{cache="redis"} 41790/sec\ndrive_cache_misses_total{cache="redis"} 3530/sec\ndrive_cache_hit_ratio{cache="redis"} 0.922\n\n# Storage metrics\ndrive_storage_used_bytes{user_type="free"} 850TB\ndrive_storage_used_bytes{user_type="paid"} 11200TB\ndrive_storage_total_bytes 1200000TB\n\n# Sync metrics\ndrive_sync_events_total{type="create"} 2315/sec\ndrive_sync_events_total{type="update"} 3158/sec\ndrive_sync_events_total{type="delete"} 314/sec\ndrive_sync_conflicts_total 23/sec\n\n# Queue metrics\ndrive_queue_depth{queue="upload"} 1245\ndrive_queue_depth{queue="sync"} 3456\ndrive_queue_processing_duration_seconds{quantile="0.95"} 1.8\n\n# Database metrics\ndrive_db_connections{state="active",db="postgres"} 876\ndrive_db_connections{state="idle",db="postgres"} 124\ndrive_db_query_duration_seconds{quantile="0.95"} 0.045\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsx)(n.p,{children:"This Google Drive system design handles:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"1 billion users"})," with horizontal scaling"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"1 trillion files"})," with efficient metadata management"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"1.2 EB storage"})," with tiered storage and deduplication"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"850 Gbps peak bandwidth"})," with CDN and chunking"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"99.99% uptime"})," with multi-region deployment"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"< 2 second sync latency"})," with real-time notifications"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"< 200ms API response"})," with multi-level caching"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Strong security"})," with encryption and access control"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Cost-effective"})," with optimization strategies"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The design prioritizes:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Scalability"}),": Horizontal scaling at every layer"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Reliability"}),": Replication, backups, failover"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Performance"}),": Caching, CDN, optimization"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security"}),": Encryption, access control, auditing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cost-efficiency"}),": Tiered storage, deduplication, compression"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);